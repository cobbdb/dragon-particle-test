!function(){Cocoon=window.Cocoon?window.Cocoon:{},Cocoon.version="3.0.5",Cocoon.nativeAvailable=!!window.ext,Cocoon.extend=function(a,b){var c=a.prototype,d=function(){};d.prototype=b.prototype,a.prototype=new d,a.superclass=b.prototype,a.prototype.constructor=a,b.prototype.constructor===Object.prototype.constructor&&(b.prototype.constructor=b);for(var e in c)c.hasOwnProperty(e)&&(a.prototype[e]=c[e])},Cocoon.clone=function(a,b){if(null==a||"object"!=typeof a)return a;var c=[];for(var d in a)b.hasOwnProperty(d)?c.push(b[d]):c.push(a[d]);return c},Cocoon.callNative=function(a,b,c,d){if(Cocoon.nativeAvailable){var e=Array.prototype.slice.call(c);e.unshift(b);var f=ext[a],g=d?f.makeCallAsync:f.makeCall,h=g.apply(f,e),i=h;if("string"==typeof h)try{i=JSON.parse(h)}catch(j){console.log(j)}return i}},Cocoon.getObjectFromPath=function(a,b){for(var c=b.split("."),d=a,e=0,f=c.length;f>e;++e)d[c[e]]=d[c[e]]||void 0,d=d[c[e]];return d},Cocoon.EventHandler=function(a,b,c,d){return this.listeners=[],this.listenersOnce=[],this.chainFunction=d,this.addEventListener=function(e){if(d){var f=function(){d.call(this,arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};e.CocoonEventHandlerChainFunction=f,f.sourceListener=e,e=f}var g=Cocoon.getObjectFromPath(Cocoon,b);if(g&&g.nativeAvailable)ext[a].addEventListener(c,e);else{var h=this.listeners.indexOf(e);0>h&&this.listeners.push(e)}},this.addEventListenerOnce=function(e){if(d){var f=function(){d(arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};f.sourceListener=e,e=f}var g=Cocoon.getObjectFromPath(Cocoon,b);if(g.nativeAvailable)ext[a].addEventListenerOnce(c,e);else{var h=this.listeners.indexOf(e);0>h&&this.listenersOnce.push(e)}},this.removeEventListener=function(e){d&&(e=e.CocoonEventHandlerChainFunction,delete e.CocoonEventHandlerChainFunction);var f=Cocoon.getObjectFromPath(Cocoon,b);if(f.nativeAvailable)ext[a].removeEventListener(c,e);else{var g=this.listeners.indexOf(e);g>=0&&this.listeners.splice(g,1)}},this.removeEventListenerOnce=function(e){d&&(e=e.CocoonEventHandlerChainFunction,delete e.CocoonEventHandlerChainFunction);var f=Cocoon.getObjectFromPath(Cocoon,b);if(f.nativeAvailable)ext[a].removeEventListenerOnce(c,e);else{var g=this.listenersOnce.indexOf(e);g>=0&&this.listenersOnce.splice(g,1)}},this.notifyEventListeners=function(){var d=Cocoon.getObjectFromPath(Cocoon,b);if(d&&d.nativeAvailable)ext[a].notifyEventListeners(c);else{var e=Array.prototype.slice.call(arguments),f=Array.prototype.slice.call(this.listeners),g=Array.prototype.slice.call(this.listenersOnce),h=this;setTimeout(function(){for(var a=0;a<f.length;a++)f[a].apply(h,e);for(var a=0;a<g.length;a++)g[a].apply(h,e)},0),h.listenersOnce=[]}},this},Cocoon.define=function(a,b){for(var c="Cocoon."==a.substring(0,7)?a.substr(7):a,d=window.Cocoon,e=c.split("."),f=d,g=0;g<e.length;g++){var h=e[g];if(f[h]?console.log("Updated namespace: - "+a):console.log("Created namespace: "+a),f=f[h]=g==e.length-1?b(f[h]||{}):{},!f)throw"Unable to create class "+a}return!0},console.log("Created namespace: Cocoon")}(),Cocoon.define("Cocoon.Signal",function(a){"use strict";return a.createSignal=function(){this.handle=null,this.signals={},this.register=function(a,b){if(!a&&!b)throw new Error("Can't create signal "+(a||""));if(b.addEventListener)return this.signals[a]=b,!0;if(!b.addEventListener){this.signals[a]={};for(var c in b)b.hasOwnProperty(c)&&(this.signals[a][c]=b[c]);return!0}throw new Error("Can't create handler for "+a+" signal.")},this.expose=function(){return function(a,b,c){var d=!1;if(1===arguments.length){var e=this,f=function(a){this.signal=a};return f.prototype.remove=function(a){var b=e.signals[this.signal];b&&b.removeEventListener&&(b.removeEventListener.apply(e,[a]),e.signals[this.signal]=void 0)},new f(a)}if(c&&c.once&&(d=!0),!this.signals[a])throw new Error("The signal "+a+" does not exists.");var g=this.signals[a];if(g.addEventListener&&(d?g.addEventListenerOnce(function(){b.apply(this||window,arguments)}):g.addEventListener(function(){b.apply(this||window,arguments)})),!this.signals[a].addEventListener)for(var h in this.signals[a])if(this.signals[a].hasOwnProperty(h)){var g=this.signals[a][h];d?g.addEventListenerOnce(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:h,clbk:b})):g.addEventListener(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:h,clbk:b}))}}.bind(this)}},a}),Cocoon.define("Cocoon.App",function(a){a.nativeAvailable=!!window.ext&&!!window.ext.IDTK_APP,a.isBridgeAvailable=function(){if("boolean"===Cocoon.App.forward.nativeAvailable)return Cocoon.App.forward.nativeAvailable;var a=Cocoon.callNative("IDTK_APP","forwardAvailable",arguments);return a=!!a,Cocoon.App.forward.nativeAvailable=a,a},a.forward=function(a){return Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable()?Cocoon.callNative("IDTK_APP","forward",arguments):navigator.isCocoonJS?void 0:"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?window.parent.eval(a):window.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(a)},a.forwardAsync=function(a,b){return Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable()?"undefined"!=typeof b?ext.IDTK_APP.makeCallAsync("forward",a,b):ext.IDTK_APP.makeCallAsync("forward",a):void setTimeout(function(){var c;"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?(c=window.parent.eval(a),"function"==typeof b&&b(c)):(c=window.parent.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(a),"function"==typeof b&&b(c))},1)},a.load=function(a,b){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","loadPath",arguments);if(!navigator.isCocoonJS){var c=new XMLHttpRequest;c.onreadystatechange=function(b){if(4===c.readyState)if(200===c.status){var d;d=Cocoon.App.EmulatedWebViewIFrame?"window.Cocoon && window.Cocoon.App.onLoadInCocoonJSSucceed.notifyEventListeners('"+a+"');":"window.Cocoon && window.Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners('"+a+"');",Cocoon.App.forwardAsync(d),window.location.href=a}else if(404===c.status){this.onreadystatechange=null;var d;d=Cocoon.App.EmulatedWebViewIFrame?"Cocoon && Cocoon.App.onLoadInCocoonJSFailed.notifyEventListeners('"+a+"');":"Cocoon && Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners('"+a+"');",Cocoon.App.forwardAsync(d)}},c.open("GET",a,!0),c.send()}},a.reload=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","reload",arguments):navigator.isCocoonJS?void 0:"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?window.parent.location.reload():window.parent.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.location.reload()},a.openURL=function(a){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","openURL",arguments,!0):void(navigator.isCocoonJS||window.open(a,"_blank"))},a.exit=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","forceToFinish",arguments):void(navigator.isCocoonJS||window.close())},a.StorageType={APP_STORAGE:"APP_STORAGE",INTERNAL_STORAGE:"INTERNAL_STORAGE",EXTERNAL_STORAGE:"EXTERNAL_STORAGE",TEMPORARY_STORAGE:"TEMPORARY_STORAGE"},a.onSuspended=new Cocoon.EventHandler("IDTK_APP","App","onsuspended"),a.onActivated=new Cocoon.EventHandler("IDTK_APP","App","onactivated"),a.onSuspending=new Cocoon.EventHandler("IDTK_APP","App","onsuspending"),a.onMemoryWarning=new Cocoon.EventHandler("IDTK_APP","App","onmemorywarning");var b=new Cocoon.Signal.createSignal;return b.register("suspended",a.onSuspended),b.register("activated",a.onActivated),b.register("suspending",a.onSuspending),b.register("memorywarning",a.onMemoryWarning),a.on=b.expose(),a}),Cocoon.define("Cocoon.App",function(a){function b(){var a=Cocoon.App.EmulatedWebView;if(!a){a=document.createElement("div"),a.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewDiv"),a.style.width=0,a.style.height=0,a.style.position="absolute",a.style.left=0,a.style.top=0,a.style.backgroundColor="transparent",a.style.border="0px solid #000";var b=document.createElement("IFRAME");b.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewIFrame"),b.setAttribute("name","CocoonJS_App_ForCocoonJS_WebViewIFrame"),b.style.width=0,b.style.height=0,b.frameBorder=0,b.allowtransparency=!0,a.appendChild(b),Cocoon.App.EmulatedWebView=a,Cocoon.App.EmulatedWebViewIFrame=b,document.body||(document.body=document.createElement("body")),document.body.appendChild(Cocoon.App.EmulatedWebView)}}a.pause=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","pause",arguments):void 0},a.resume=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","resume",arguments):void 0},a.loadInTheWebView=function(a,c){if(navigator.isCocoonJS&&Cocoon.App.nativeAvailable)Cocoon.callNative("IDTK_APP","loadInTheWebView",arguments);else{var d=new XMLHttpRequest;d.onreadystatechange=function(c){if(4===d.readyState)if(d.status>=200&&d.status<=299||0===d.status){b();var e=function(b){Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners(a),Cocoon.App.EmulatedWebViewIFrame.removeEventListener("load",e)};Cocoon.App.EmulatedWebViewIFrame.addEventListener("load",e),Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.href=a}else this.onreadystatechange=null,Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners(a)},d.open("GET",a,!0),d.send()}},a.reloadWebView=function(){Cocoon.App.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","reloadWebView",arguments):(b(),Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.reload())},a.showTheWebView=function(a,c,d,e){Cocoon.App.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","showTheWebView",arguments):(b(),Cocoon.App.EmulatedWebViewIFrame.style.width=(d?d/window.devicePixelRatio:window.innerWidth)+"px",Cocoon.App.EmulatedWebViewIFrame.style.height=(e?e/window.devicePixelRatio:window.innerHeight)+"px",Cocoon.App.EmulatedWebView.style.left=(a?a:0)+"px",Cocoon.App.EmulatedWebView.style.top=(c?c:0)+"px",Cocoon.App.EmulatedWebView.style.width=(d?d/window.devicePixelRatio:window.innerWidth)+"px",Cocoon.App.EmulatedWebView.style.height=(e?e/window.devicePixelRatio:window.innerHeight)+"px",Cocoon.App.EmulatedWebView.style.display="block")},a.hideTheWebView=function(){if(Cocoon.App.nativeAvailable&&navigator.isCocoonJS){var a="ext.IDTK_APP.makeCall('hide');";return Cocoon.App.forwardAsync(a)}b(),Cocoon.App.EmulatedWebView.style.display="none"},a.exitCallback=function(a){navigator.isCocoonJS&&Cocoon.App.nativeAvailable&&(window.onidtkappfinish=a)},a.forwardedEventFromTheWebView=function(a,b){var c=JSON.parse(b);c.target=window;var d=new Event(a);for(var e in c)d[e]=c[e];d.target=window,window.dispatchEvent(d);for(var f=document.getElementsByTagName("canvas"),g=0;g<f.length;g++)d.target=f[g],f[g].dispatchEvent(d)},a.onLoadInTheWebViewSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload"),a.onLoadInTheWebViewFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail");var c=new Cocoon.Signal.createSignal;return c.register("load",{success:a.onLoadInTheWebViewSucceed,error:a.onLoadInTheWebViewFailed}),a.WebView=Cocoon.WebView||{},a.WebView.on=c.expose(),a}),Cocoon.define("Cocoon.Utils",function(a){"use strict";return a.logMemoryInfo=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","logMemoryInfo",arguments):void 0},a.textureReduction=function(a,b,c){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setDefaultTextureReducerThreshold",arguments):void 0},a.markAsMusic=function(a){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","addForceMusic",arguments):void 0},a.captureScreen=function(a,b,c,d){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","captureScreen",arguments):void 0},a.captureScreenAsync=function(a,b,c,d,e){Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","captureScreen",arguments,!0)},a.setAntialias=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments):void 0},a.setWebGLEnabled=function(a){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments):void 0},a.setNPOTEnabled=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?window.ext.IDTK_APP.makeCall("setNPOTEnabled",a):void 0},a.setMaxMemory=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?window.ext.IDTK_APP.makeCall("setMaxMemory",a):void 0},a.CaptureType={EVERYTHING:0,COCOONJS_GL_SURFACE:1,JUST_SYSTEM_VIEWS:2},a.existsPath=function(a,b){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","existsPath",arguments):!1},a.setTextCacheSize=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setTextCacheSize",arguments):void 0},a}),Cocoon.define("Cocoon.Dialog",function(a){"use strict";return a.keyboardType={TEXT:"text",NUMBER:"num",PHONE:"phone",EMAIL:"email",URL:"url"},a.prompt=function(a,b){if(!b)throw"Callback missing for Cocoon.Dialog.prompt();";var c=Cocoon.Dialog.keyboardType.TEXT;switch(a.type){case Cocoon.Dialog.keyboardType.TEXT:c=Cocoon.Dialog.keyboardType.TEXT;break;case Cocoon.Dialog.keyboardType.NUMBER:c=Cocoon.Dialog.keyboardType.NUMBER;break;case Cocoon.Dialog.keyboardType.PHONE:c=Cocoon.Dialog.keyboardType.PHONE;break;case Cocoon.Dialog.keyboardType.EMAIL:c=Cocoon.Dialog.keyboardType.EMAIL;break;case Cocoon.Dialog.keyboardType.URL:c=Cocoon.Dialog.keyboardType.URL}var d={title:"",message:"",text:"",type:c,cancelText:"Cancel",confirmText:"Ok"},e=Cocoon.clone(d,a),f=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(g),Cocoon.Dialog.onTextDialogFinished.removeEventListener(f),b.success.apply(window,Array.prototype.slice.call(arguments))},g=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(g),Cocoon.Dialog.onTextDialogFinished.removeEventListener(f),b.cancel.apply(window,Array.prototype.slice.call(arguments))};return Cocoon.Dialog.onTextDialogCancelled.addEventListener(g),Cocoon.Dialog.onTextDialogFinished.addEventListener(f),Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","showTextDialog",e,!0):void setTimeout(function(){var a=prompt(d.message,d.text),b=a?Cocoon.Dialog.onTextDialogFinished:Cocoon.Dialog.onTextDialogCancelled;b.notifyEventListeners(a)},0)},a.confirm=function(a,b){if(!b)throw"Callback missing for Cocoon.Dialog.confirm();";var c={title:"",message:"",cancelText:"Cancel",confirmText:"Ok"},d=Cocoon.clone(c,a),e=function(){Cocoon.Dialog.onMessageBoxDenied.removeEventListenerOnce(f),b(!0)},f=function(){Cocoon.Dialog.onMessageBoxConfirmed.removeEventListenerOnce(e),b(!1)};return Cocoon.Dialog.onMessageBoxDenied.addEventListenerOnce(f),Cocoon.Dialog.onMessageBoxConfirmed.addEventListenerOnce(e),Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","showMessageBox",d,!0):void setTimeout(function(){var a=confirm(c.message),b=a?Cocoon.Dialog.onMessageBoxConfirmed:Cocoon.Dialog.onMessageBoxDenied;b.notifyEventListeners()},0)},a.showKeyboard=function(a,b){a=a||{},a.type=a.type||Cocoon.Dialog.keyboardType.TEXT;var c=b&&b.insertText,d=b&&b.deleteBackward,e=b&&b.done,f=b&&b.cancel;Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","showKeyboard",[a,c,d,e,f],!0)},a.dismissKeyboard=function(){Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","dismissKeyboard",[],!0)},a.onTextDialogFinished=new Cocoon.EventHandler("IDTK_APP","App","ontextdialogfinish"),a.onTextDialogCancelled=new Cocoon.EventHandler("IDTK_APP","App","ontextdialogcancel"),a.onMessageBoxConfirmed=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxconfirmed"),a.onMessageBoxDenied=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxdenied"),a}),Cocoon.define("Cocoon.WebView",function(a){return"undefined"==typeof Cocoon||null===Cocoon?a:"undefined"==typeof Cocoon.App||null===Cocoon.App?a:navigator.isCocoonJS?a:(a.show=function(a,b,c,d){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","show",arguments);var e=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv");e.style.left=(a?a:e.style.left)+"px",e.style.top=(b?b:e.style.top)+"px",e.style.width=(c?c/window.devicePixelRatio:window.parent.innerWidth)+"px",e.style.height=(d?d/window.devicePixelRatio:window.parent.innerHeight)+"px",e.style.display="block";var f=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewIFrame");f.style.width=(c?c/window.devicePixelRatio:window.parent.innerWidth)+"px",f.style.height=(d?d/window.devicePixelRatio:window.parent.innerHeight)+"px"},a.hide=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","hide",arguments):void(window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv").style.display="none")},a.loadInCocoon=function(a,b,c){if(Cocoon.App.nativeAvailable){var d="ext.IDTK_APP.makeCall('loadPath'";return"undefined"!=typeof a&&(d+=", '"+a+"'","undefined"!=typeof c&&(d+=", '"+c+"'")),d+=");",Cocoon.App.forwardAsync(d)}Cocoon.App.forwardAsync("Cocoon.App.load('"+a+"');")},a.reloadCocoonJS=function(){return Cocoon.App.nativeAvailable?Cocoon.App.forwardAsync("ext.IDTK_APP.makeCall('reload');"):void(navigator.isCocoonJS||window.parent.location.reload())},window.addEventListener("load",function(){function a(a,c){var d,e,f={};for(var d in c)e=b.indexOf(d),e>=0&&(f[d]=c[d]);var g="Cocoon && Cocoon.App && Cocoon.App.forwardedEventFromTheWebView && Cocoon.App.forwardedEventFromTheWebView("+JSON.stringify(a)+", '"+JSON.stringify(f)+"');";Cocoon.App.forward(g)}if(!Cocoon.App.nativeAvailable&&"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name){Cocoon.App.forwardEventsToCocoonJSEnabled=!1;var b=["timeStamp","button","type","x","y","pageX","pageY","clientX","clientY","offsetX","offsetY"],c=["dblclick","touchmove","mousemove","touchend","touchcancel","mouseup","touchstart","mousedown","release","dragleft","dragright","swipeleft","swiperight"];for(i=0;i<c.length;i++)window.addEventListener(c[i],function(b){return function(c){Cocoon.App.forwardEventsToCocoonJSEnabled&&a(b,c)}}(c[i]))}}),a.onLoadInCocoonJSSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload"),a.onLoadInCocoonJSFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail"),a)}),Cocoon.define("Cocoon.Proxify",function(a){"use strict";return a.getKeyForValueInDictionary=function(a,b){var c=null;for(var d in a)if(a[d]===b){c=d;break}return c},a.setupOriginProxyType=function(b,c,d,e){if(Cocoon.nativeAvailable){if(!b)throw"The given typeName must be valid.";if(!c&&!d&&!e)throw"There is no point on setting up a proxy for no attributes, functions nor eventHandlers.";c=c?c:[],d=d?d:[],e=e?e:[];var f=window,g="Cocoon.Proxify.setupDestinationProxyType("+JSON.stringify(b)+", "+JSON.stringify(e)+");";Cocoon.App.forward(g);var h=f[b];f[b]=function(){var a=this;this._cocoonjs_proxy_object_data={};var g="Cocoon.Proxify.newDestinationProxyObject("+JSON.stringify(b)+");";this._cocoonjs_proxy_object_data.id=Cocoon.App.forward(g),this._cocoonjs_proxy_object_data.eventHandlers={},this._cocoonjs_proxy_object_data.typeName=b,this._cocoonjs_proxy_object_data.eventListeners={},f[b]._cocoonjs_proxy_type_data.proxyObjects[this._cocoonjs_proxy_object_data.id]=this;for(var h=0;h<c.length;h++)!function(c){a.__defineSetter__(c,function(d){var e="Cocoon.Proxify.setDestinationProxyObjectAttribute("+JSON.stringify(b)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(c)+", "+JSON.stringify(d)+");";return Cocoon.App.forward(e)}),a.__defineGetter__(c,function(){var d="Cocoon.Proxify.getDestinationProxyObjectAttribute("+JSON.stringify(b)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(c)+");";return Cocoon.App.forward(d)})}(c[h]);for(var h=0;h<d.length;h++)!function(c){a[c]=function(){var a=Array.prototype.slice.call(arguments);a.unshift(c),a.unshift(this._cocoonjs_proxy_object_data.id),a.unshift(b);for(var d="Cocoon.Proxify.callDestinationProxyObjectFunction(",e=0;e<a.length;e++)d+=(1!==e?JSON.stringify(a[e]):a[e])+(e<a.length-1?", ":"");d+=");";var f=Cocoon.App.forwardAsync(d);return f}}(d[h]);for(var h=0;h<e.length;h++)!function(b){a.__defineSetter__(b,function(c){a._cocoonjs_proxy_object_data.eventHandlers[b]=c}),a.__defineGetter__(b,function(){return a._cocoonjs_proxy_object_data.eventHandlers[b]})}(e[h]);return a.addEventListener=function(b,c){var d=!0,e=a._cocoonjs_proxy_object_data.eventListeners[b];if(e)d=e.indexOf(c)<0;else{e=[],a._cocoonjs_proxy_object_data.eventListeners[b]=e;var f="Cocoon.Proxify.addDestinationProxyObjectEventListener("+JSON.stringify(a._cocoonjs_proxy_object_data.typeName)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(b)+");";Cocoon.App.forwardAsync(f)}d&&e.push(c)},a.removeEventListener=function(b,c){var d=a._cocoonjs_proxy_object_data.eventListeners[b];if(d){var e=d.indexOf(c);e>=0&&d.splice(e,1)}},this},f[b]._cocoonjs_proxy_type_data={originalType:h,proxyObjects:[]},f[b]._cocoonjs_proxy_type_data.deleteProxyObject=function(c){var d=a.getKeyForValueInDictionary(this.proxyObjects,c);if(d){var e="Cocoon.Proxify.deleteDestinationProxyObject("+JSON.stringify(b)+", "+c._cocoonjs_proxy_object_data.id+");";Cocoon.App.forwardAsync(e),c._cocoonjs_proxy_object_data=null,delete this.proxyObjects[d]}},f[b]._cocoonjs_proxy_type_data.callProxyObjectEventHandler=function(a,b){var c=this.proxyObjects[a],d=c._cocoonjs_proxy_object_data.eventHandlers[b];d&&d({target:c})},f[b]._cocoonjs_proxy_type_data.callProxyObjectEventListeners=function(a,b){for(var c=this.proxyObjects[a],d=c._cocoonjs_proxy_object_data.eventListeners[b].slice(),e=0;e<d.length;e++)d[e]({target:c})}}},a.takedownOriginProxyType=function(a){if(Cocoon.App.nativeAvailable){var b=window;b[a]&&b[a]._cocoonjs_proxy_type_data&&(b[a]=b[a]._cocoonjs_proxy_type_data.originalType)}},a.deleteOriginProxyObject=function(a){if(Cocoon.App.nativeAvailable){var b=window;a&&a._cocoonjs_proxy_object_data&&b[a._cocoonjs_proxy_object_data.typeName]._cocoonjs_proxy_type_data.deleteProxyObject(a)}},a.callOriginProxyObjectEventHandler=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window;d[a]._cocoonjs_proxy_type_data.callProxyObjectEventHandler(b,c)}},a.callOriginProxyObjectEventListeners=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window;d[a]._cocoonjs_proxy_type_data.callProxyObjectEventListeners(b,c)}},a.setupDestinationProxyType=function(a,b){if(Cocoon.App.nativeAvailable){var c=window;c[a]._cocoonjs_proxy_type_data={nextId:0,proxyObjects:{},eventHandlerNames:b}}},a.takedownDestinationProxyType=function(a){if(Cocoon.App.nativeAvailable){var b=window;parent[a]&&b[a]._cocoonjs_proxy_type_data&&delete b[a]._cocoonjs_proxy_type_data}},a.newDestinationProxyObject=function(a){if(Cocoon.App.nativeAvailable){var b=window,c=new b[a];c._cocoonjs_proxy_object_data={},c._cocoonjs_proxy_object_data.typeName=a;var d=b[a]._cocoonjs_proxy_type_data.nextId;b[a]._cocoonjs_proxy_type_data.proxyObjects[d]=c,c._cocoonjs_proxy_object_data.id=d,b[a]._cocoonjs_proxy_type_data.nextId++;for(var e=0;e<b[a]._cocoonjs_proxy_type_data.eventHandlerNames.length;e++)!function(a){c[a]=function(b){var c=this,d="Cocoon.App.callOriginProxyObjectEventHandler("+JSON.stringify(c._cocoonjs_proxy_object_data.typeName)+", "+c._cocoonjs_proxy_object_data.id+", "+JSON.stringify(a)+");";Cocoon.App.forwardAsync(d)}}(b[a]._cocoonjs_proxy_type_data.eventHandlerNames[e]);return c._cocoonjs_proxy_object_data.eventListeners={},d}},a.callDestinationProxyObjectFunction=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window,e=Array.prototype.slice.call(arguments);e.splice(0,3);var f=d[a]._cocoonjs_proxy_type_data.proxyObjects[b],g=f[c].apply(f,e);return g}},a.setDestinationProxyObjectAttribute=function(a,b,c,d){if(Cocoon.App.nativeAvailable){var e=window,f=e[a]._cocoonjs_proxy_type_data.proxyObjects[b];f[c]=d}},a.getDestinationProxyObjectAttribute=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window,e=d[a]._cocoonjs_proxy_type_data.proxyObjects[b];return e[c]}},a.deleteDestinationProxyObject=function(a,b){if(Cocoon.App.nativeAvailable){var c=window;delete c[a]._cocoonjs_proxy_type_data.proxyObjects[b]}},a.addDestinationProxyObjectEventListener=function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window,e=d[a]._cocoonjs_proxy_type_data.proxyObjects[b],f=function(a){var b=this,d="Cocoon.Proxify.callOriginProxyObjectEventListeners("+JSON.stringify(b._cocoonjs_proxy_object_data.typeName)+", "+b._cocoonjs_proxy_object_data.id+", "+JSON.stringify(c)+");";Cocoon.App.forwardAsync(d)};e._cocoonjs_proxy_object_data.eventListeners[c]=f,e.addEventListener(c,f)}},a.xhr=function(){var a=["timeout","withCredentials","upload","status","statusText","responseType","response","responseText","responseXML","readyState"],b=["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","overrideMimeType"],c=["onloadstart","onprogress","onabort","onerror","onload","ontimeout","onloadend","onreadystatechange"];Cocoon.Proxify.setupOriginProxyType("XMLHttpRequest",a,b,c)},a.audio=function(){var a=["src","loop","volume","preload"],b=["play","pause","load","canPlayType"],c=["onended","oncanplay","oncanplaythrough","onerror"];Cocoon.Proxify.setupOriginProxyType("Audio",a,b,c)},a.console=function(){if(Cocoon.nativeAvailable){"undefined"==typeof Cocoon.originalConsole&&(Cocoon.originalConsole=window.console);for(var a=["log","error","info","debug","warn"],b={},c=0;c<a.length;c++)b[a[c]]=function(a){return function(a){try{var b="Proxified log: "+JSON.stringify(a);Cocoon.originalConsole.log(b),ext.IDTK_APP.makeCallAsync("forward",b)}catch(c){console.log("Proxified log: "+c)}}}(a[c]);b.assert||(b.assert=function(){if(arguments.length>0&&!arguments[0]){var a="Assertion failed: "+(arguments.length>1?arguments[1]:"");b.error(a)}}),window.console=b}},a.deproxifyConsole=function(){!window.navigator.isCocoonJS&&Cocoon.nativeAvailable&&"undefined"!=typeof Cocoon.originalConsole&&(window.console=Cocoon.originalConsole,Cocoon.originalConsole=void 0)},a}),Cocoon.define("Cocoon.Device",function(a){"use strict";return a.DeviceInfo={os:null,version:null,dpi:null,brand:null,model:null,imei:null,platformId:null,odin:null,openudid:null},a.getDeviceId=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getDeviceId"):void 0},a.getDeviceInfo=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getDeviceInfo"):void 0},a.getOrientation=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getPreferredOrientation"):0},a.setOrientation=function(a){Cocoon.nativeAvailable&&window.ext.IDTK_APP.makeCall("setPreferredOrientation",a)},a.Orientations={PORTRAIT:1,PORTRAIT_UPSIDE_DOWN:2,LANDSCAPE_LEFT:4,LANDSCAPE_RIGHT:8,LANDSCAPE:12,BOTH:15},a.autoLock=function(a){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","setAutoLockEnabled",arguments):void 0},a}),Cocoon.define("Cocoon.Motion",function(a){"use strict";return a.nativeAvailable=Cocoon.nativeAvailable,a.setAccelerometerInterval=function(a){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("setAccelerometerUpdateIntervalInSeconds",a):void 0},a.getAccelerometerInterval=function(){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("getAccelerometerUpdateIntervalInSeconds"):void 0},a.setGyroscopeInterval=function(a){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("setGyroscopeUpdateIntervalInSeconds",a):void 0},a.getGyroscopeInterval=function(){Cocoon.Motion.nativeAvailable&&window.ext.IDTK_APP.makeCall("getGyroscopeUpdateIntervalInSeconds")},a}),Cocoon.define("Cocoon.Touch",function(a){return a.addADivToDisableInput=function(){var a=document.createElement("div");a.id="CocoonJSInputBlockingDiv",a.style.left=0,a.style.top=0,a.style.width="100%",a.style.height="100%",a.style.position="absolute",a.style.backgroundColor="transparent",a.style.border="0px solid #000",a.style.zIndex=999999999,document.body.appendChild(a)},a.removeTheDivToEnableInput=function(){var a=document.getElementById("CocoonJSInputBlockingDiv");a&&document.body.removeChild(a)},a.disable=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("disableTouchLayer","CocoonJSView"):navigator.isCocoonJS||Cocoon.App.EmulatedWebViewIFrame||(Cocoon.App.forwardEventsToCocoonJSEnabled=!1,Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disable();"))},a.enable=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("enableTouchLayer","CocoonJSView"):navigator.isCocoonJS||Cocoon.App.EmulatedWebViewIFrame||(Cocoon.App.forwardEventsToCocoonJSEnabled=!0,Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enable();"))},a.disableInWebView=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("disableTouchLayer","WebView"):navigator.isCocoonJS||(Cocoon.App.EmulatedWebViewIFrame?Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disableInWebView();"):Cocoon.Touch.addADivToDisableInput())},a.enableInWebView=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("enableTouchLayer","WebView"):navigator.isCocoonJS||(Cocoon.App.EmulatedWebViewIFrame?Cocoon.Touch.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enableInWebView();"):Cocoon.Touch.removeTheDivToEnableInput())},a}),Cocoon.define("Cocoon.Widget",function(a){"use strict";return a.WebDialog=function(){if(Cocoon.App.nativeAvailable)this.webDialogID=window.ext.IDTK_APP.makeCall("createWebDialog");else{var a=document.createElement("iframe");a.id="CocoonJSWebDialogIFrame",a.name="CocoonJSWebDialogIFrame",a.style.cssText="position:fixed;left:0;top:0;bottom:0;right:0; width:100%; height:100%;margin:0;padding:0;";var b=this;a.onload=function(){b.iframeloaded=!0;var a="Cocoon = {}; Cocoon.Widget = {}; Cocoon.Widget.WebDialog = {} Cocoon.Widget.WebDialog.close = function(){   window.parent.CocoonJSCloseWebDialog();};";b.evalIframe(a);for(var c=0;c<b.pendingEvals.length;++c)b.evalIframe(b.pendingEvals[c]);b.pendingEvals=[]},a.onerror=function(){b.close()},this.iframe=a,this.pendingEvals=[],window.CocoonJSCloseWebDialog=function(){b.close()}}},a.WebDialog.prototype={show:function(a,b){return this.closeCallback=function(){Cocoon.Touch.enable(),b&&b()},Cocoon.App.nativeAvailable?(Cocoon.Touch.disable(),window.ext.IDTK_APP.makeCallAsync("showWebDialog",this.webDialogID,a,this.closeCallback)):(this.iframe.src=a,void document.body.appendChild(this.iframe))},close:function(){return Cocoon.App.nativeAvailable?window.ext.IDTK_APP.makeCallAsync("closeWebDialog",this.webDialogID):(this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),void(this.closeCallback&&this.closeCallback()))},evalIframe:function(a){window.frames.CocoonJSWebDialogIFrame.eval(a)},eval:function(a){return Cocoon.App.nativeAvailable?window.ext.IDTK_APP.makeCallAsync("evalWebDialog",this.webDialogID,a):void(this.iframeloaded?this.evalIframe(a):this.pendingEvals.push(a))}},a}),Cocoon.define("Cocoon.Camera",function(a){return navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,a.CameraType={FRONT:"FRONT",BACK:"BACK"},a.CaptureFormatType={JPEG:"JPEG",RGB_565:"RGB_565",NV21:"NV21",NV16:"NV16",YUY2:"YUY2",YV12:"YV12",BGRA32:"32BGRA"},a.CameraInfo={cameraIndex:0,cameraType:a.CameraType.BACK,supportedVideoSizes:[],supportedVideoFrameRates:[],supportedVideoCaptureImageFormats:[]},a.getNumberOfCameras=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getNumberOfCameras",arguments):navigator.getUserMedia_?1:0},a.getAllCamerasInfo=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getAllCamerasInfo",arguments):void 0},a.getCameraInfoByIndex=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getCameraInfoByIndex",arguments):void 0},a.getCameraInfoByType=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getCameraInfoByType",arguments):void 0},a.start=function(a){if(!Boolean(a.success)||!Boolean(a.error))throw new Error("Missing callbacks for Cocoon.Camera.start();");
if(Cocoon.nativeAvailable){var b={cameraIndex:0,width:50,height:50,frameRate:25},c=Cocoon.clone(b,a),d=Cocoon.callNative("IDTK_SRV_CAMERA","startCapturing",c);Boolean(d)?a.success(d):a.error(!1)}else navigator.getUserMedia_({video:!0,audio:!1},function(b){a.success(b)},function(b){a.error(b)})},a.stop=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","stopCapturing",arguments):void 0},a.isCapturing=function(a){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","isCapturing",arguments):void 0},a}),Cocoon.define("Cocoon.Ad",function(a){"use strict";a.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_AD,a.BannerLayout={TOP_CENTER:"TOP_CENTER",BOTTOM_CENTER:"BOTTOM_CENTER"},a.Rectangle=function(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d},a.Banner=function(a){if("number"!=typeof a)throw"The given ad ID is not a number.";this.id=a;var b=this;this.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow",function(a,c){b.id===c[0]&&a()}),this.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerhide",function(a,c){b.id===c[0]&&a()}),this.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready",function(a,c){b.id===c[0]&&a(c[1],c[2])});var c=new Cocoon.Signal.createSignal;c.register("ready",this.onBannerReady),c.register("shown",this.onBannerShown),c.register("hidden",this.onBannerHidden),this.on=c.expose()},a.Banner.prototype={showBanner:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","showBanner",[this.id],!0)},hideBanner:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","hideBanner",[this.id],!0)},load:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","refreshBanner",[this.id],!0)},getRectangle:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","getRectangle",[this.id]):void 0},setRectangle:function(a){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setRectangle",[this.id,a]):void 0},setBannerLayout:function(a){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setBannerLayout",[this.id,a]):void 0}},a.Interstitial=function(a){if("number"!=typeof a)throw"The given ad ID is not a number.";this.id=a;var b=this;this.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenshow",function(a,c){b.id===c[0]&&a()}),this.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide",function(a,c){b.id===c[0]&&a()}),this.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready",function(a,c){b.id===c[0]&&a()});var c=new Cocoon.Signal.createSignal;c.register("ready",this.onFullScreenReady),c.register("shown",this.onFullScreenShown),c.register("hidden",this.onFullScreenHidden),this.on=c.expose()},a.Interstitial.prototype={showInterstitial:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showFullScreen",[this.id],!0):void 0},refreshInterstitial:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",[this.id],!0):void 0}},a.configure=function(a){return"undefined"==typeof a&&(a={}),Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","requestInitialization",arguments,!0):void 0},a.createBanner=function(b){if("undefined"==typeof b&&(b={}),Cocoon.Ad.nativeAvailable){var c=Cocoon.callNative("IDTK_SRV_AD","createBanner",[b]),d=new a.Banner(c);return d}},a.releaseBanner=function(a){if("undefined"==typeof a)throw"The banner ad object to be released is undefined";Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","releaseBanner",[a.id])},a.createInterstitial=function(a){if("undefined"==typeof a&&(a={}),Cocoon.Ad.nativeAvailable){var b=Cocoon.callNative("IDTK_SRV_AD","createFullscreen",[a]),c=new Cocoon.Ad.Interstitial(b);return c}},a.releaseInterstitial=function(a){if(!a)throw"The fullscreen ad object to be released is undefined";Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","releaseFullscreen",[a.id])},a.showBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showBanner",arguments,!0):void 0},a.hideBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","hideBanner",arguments,!0):void 0},a.refreshBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshBanner",arguments,!0):void 0},a.showInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showFullScreen",arguments,!0):void 0},a.refreshInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",arguments,!0):void 0},a.preloadedBanner=!1,a.loadBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.Ad.preloadedBanner?Cocoon.Ad.refreshBanner():(Cocoon.Ad.preloadedBanner=!0,Cocoon.callNative("IDTK_SRV_AD","preloadBanner",arguments,!0)):void 0},a.preloadedInterstitial=!1,a.loadInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.Ad.preloadedInterstitial?Cocoon.Ad.refreshInterstitial():(Cocoon.Ad.preloadedInterstitial=!0,Cocoon.callNative("IDTK_SRV_AD","preloadFullScreen",arguments,!0)):void 0},a.setRectangle=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setRectangle",arguments):void 0},a.getRectangle=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","getRectangle",arguments):void 0},a.setBannerLayout=function(a){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setBannerLayout",arguments):void 0},a.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow"),a.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerhide"),a.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready"),a.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenshow"),a.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide"),a.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready");var b=new Cocoon.Signal.createSignal;b.register("ready",a.onBannerReady),b.register("shown",a.onBannerShown),b.register("hidden",a.onBannerHidden),a.banner={},a.banner.on=b.expose();var b=new Cocoon.Signal.createSignal;return b.register("ready",a.onFullScreenReady),b.register("shown",a.onFullScreenShown),b.register("hidden",a.onFullScreenHidden),a.interstitial={},a.interstitial.on=b.expose(),a}),Cocoon.define("Cocoon.Store",function(a){"use strict";a.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_STORE,a.ProductInfo={productId:"productId",productAlias:"productAlias",productType:"productType",title:"title",description:"description",price:"price",localizedPrice:"localizedPrice",downloadURL:"downloadURL"},a.ProductType={CONSUMABLE:0,NON_CONSUMABLE:1,AUTO_RENEWABLE_SUBSCRIPTION:2,FREE_SUBSCRIPTION:3,NON_RENEWABLE_SUBSCRIPTION:4},a.StoreType={APP_STORE:0,PLAY_STORE:1,MOCK_STORE:2,CHROME_STORE:3,AMAZON_STORE:4,NOOK_STORE:5},a.PurchaseInfo=function(a,b,c,d,e){return this.transactionId=a,this.purchaseTime=b,this.purchaseState=c,this.productId=d,this.quantity=e,this},a.PurchaseState={PURCHASED:0,CANCELED:1,REFUNDED:2,EXPIRED:3},a.getStoreType=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getStoreType",arguments):!1},a.initialize=function(a){a=a||{};var b={sandbox:!1,managed:!0},c=Cocoon.clone(b,a);Cocoon.Store.requestInitialization({sandbox:c[0],managed:c[1]}),Cocoon.Store.start()},a.requestInitialization=function(a){return"undefined"==typeof a?a={}:(void 0!==a.managed&&(a.remote=a.managed),void 0!==a.sandbox&&(a.debug=a.sandbox)),Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","requestInitialization",arguments,!0):void 0},a.start=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","start",arguments):void 0},a.canPurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","canPurchase",arguments):!1},a.fetchProductsFromServer=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromServer",arguments,!0):void 0},a.loadProducts=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromStore",arguments,!0):void 0},a.finish=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","finishPurchase",arguments,!0):void 0},a.consume=function(a,b){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","consumePurchase",arguments,!0):void 0},a.purchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeature",arguments,!0):void 0},a.puchaseProductModal=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModal",arguments,!0):void 0},a.purchaseProductModalWithPreview=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModalWithPreview",arguments,!0):void 0},a.isProductPurchased=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","isFeaturePurchased",arguments):void 0},a.restore=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","restorePurchases",arguments,!0):void 0},a.restorePurchasesModal=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","restorePurchasesModal",arguments,!0):void 0},a.getProducts=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getProducts",arguments):void 0},a.addProduct=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","addProduct",arguments):void 0},a.removeProduct=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","removeProduct",arguments):void 0},a.getPurchases=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getPurchases",arguments):void 0},a.addPurchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","addPurchase",arguments):void 0},a.removePurchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","removePurchase",arguments):void 0},a.cancelPurchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","cancelPurchase",arguments):void 0},a.refundPurchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","refundPurchase",arguments):void 0},a.expirePurchase=function(a){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","expirePurchase",arguments):void 0},a.onProductsFetchStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchStarted"),a.onProductsFetchCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchCompleted"),a.onProductsFetchFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchFailed"),a.onProductPurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseStarted"),a.onProductPurchaseVerificationRequestReceived=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseVerificationRequestReceived"),a.onProductPurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseCompleted"),a.onProductPurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseFailed"),a.onRestorePurchasesStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesStarted"),a.onRestorePurchasesCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesCompleted"),a.onRestorePurchasesFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesFailed"),a.onConsumePurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseStarted"),a.onConsumePurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseCompleted"),a.onConsumePurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseFailed");var b=new Cocoon.Signal.createSignal;return b.register("load",{started:a.onProductsFetchStarted,success:a.onProductsFetchCompleted,error:a.onProductsFetchFailed}),b.register("purchase",{started:a.onProductPurchaseStarted,success:a.onProductPurchaseCompleted,verification:a.onProductPurchaseVerificationRequestReceived,error:a.onProductPurchaseFailed}),b.register("consume",{started:a.onConsumePurchaseStarted,success:a.onConsumePurchaseCompleted,error:a.onConsumePurchaseFailed}),b.register("restore",{started:a.onRestorePurchasesStarted,success:a.onRestorePurchasesCompleted,error:a.onRestorePurchasesFailed}),a.on=b.expose(),a}),Cocoon.define("Cocoon.Notification",function(a){a.nativeAvailable=!!window.ext&&!!window.ext.IDTK_SRV_NOTIFICATION,a.Local={},a.Push={},a.Local.create=function(a){var b={message:"",soundEnabled:!0,badgeNumber:0,userData:{},contentBody:"",contentTitle:"",date:(new Date).valueOf()+1e3},c=Cocoon.clone(b,a);return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","createLocalNotification",c):void 0},a.Push.create=function(a){var b={message:"",soundEnabled:!0,badgeNumber:0,userData:{},channels:[],expirationTime:0,expirationTimeInterval:0};for(var c in b)a[c]||(a[c]=b[c]);return a},a.start=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","start",arguments):void 0},a.Push.register=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","registerForPushNotifications",arguments,!0):void 0},a.Push.unregister=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","unregisterForPushNotifications",arguments,!0):void 0},a.Local.cancel=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments):void 0},a.Local.cancelLast=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments,!0):void 0},a.Local.cancelAllNotifications=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelAllLocalNotifications",arguments):void 0},a.Local.send=function(a){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","sendLocalNotification",arguments,!0):void 0},a.subscribe=function(a){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","subscribe",arguments,!0):void 0},a.unsubscribe=function(a){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","unsubscribe",arguments,!0):void 0},a.Push.send=function(a){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","sendPushNotification",arguments,!0):void 0},a.setBadgeNumber=function(a){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","setBadgeNumber",arguments):void 0},a.getBadgeNumber=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getBadgeNumber",arguments):void 0},a.Local.getLastNotificationData=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedLocalNotificationData",arguments):void 0},a.Push.getLastNotificationData=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedPushNotificationData",arguments):void 0},a.onRegisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceRegistered"),a.onUnregisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceUnregistered"),a.onRegisterForPushNotificationsFailed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceFailedToRegister"),a.onPushNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationReceived"),a.onLocalNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","localNotificationReceived"),a.onPushNotificationDeliverySucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationSuccessfullyDelivered"),a.onPushNotificationDeliveryFailed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationDeliveryError");var b=new Cocoon.Signal.createSignal;b.register("notification",{received:a.onLocalNotificationReceived}),a.Local.on=b.expose();var b=new Cocoon.Signal.createSignal;return b.register("register",{success:a.onRegisterForPushNotificationsSucceed,unregister:a.onUnregisterForPushNotificationsSucceed,error:a.onRegisterForPushNotificationsFailed}),b.register("notification",{received:a.onPushNotificationReceived}),b.register("deliver",{success:a.onPushNotificationDeliverySucceed,error:a.onPushNotificationDeliveryFailed}),a.Push.on=b.expose(),a}),Cocoon.define("Cocoon.Social",function(a){return a.Interface=function(){this.onLoginStatusChanged=new Cocoon.EventHandler("","dummy","onLoginStatusChanged");var a=new Cocoon.Signal.createSignal;return a.register("loginStatusChanged",this.onLoginStatusChanged),this.on=a.expose(),this},a.Interface.prototype={isLoggedIn:function(){return!1},login:function(a){a&&a(!1,{message:"Not implemented!"})},logout:function(a){a&&a({message:"Not implemented!"})},getLoggedInUser:function(){return null},hasPublishPermissions:function(a){a(!0)},requestPublishPermissions:function(a){a&&a(!0,null)},requestUser:function(a,b){a(null,{message:"Not implemented!"})},requestUserImage:function(a,b,c){a("",{message:"Not implemented!"})},requestFriends:function(a,b){a([],{message:"Not implemented!"})},publishMessage:function(a,b){b({message:"Not implemented!"})},publishMessageWithDialog:function(a,b){b({message:"Not implemented!"})}},a.SocialGamingService=function(){return Cocoon.Social.SocialGamingService.superclass.constructor.call(this),this},a.SocialGamingService.prototype={_cachedAchievements:null,_achievementsMap:null,_leaderboardsTemplate:null,_achievementsTemplate:null,requestScore:function(a,b){a(null,{message:"Not implemented!"})},submitScore:function(a,b,c){b&&b({message:"Not implemented!"})},showLeaderboard:function(a,b){a&&a({message:"Not implemented!"})},requestAllAchievements:function(a){a([],{message:"Not implemented!"})},requestAchievements:function(a,b){a([],{message:"Not implemented!"})},submitAchievement:function(a,b){b&&b({message:"Not implemented!"})},resetAchievements:function(a){a&&a([],{message:"Not implemented!"})},showAchievements:function(a){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";var b=new Cocoon.Widget.WebDialog,c=!1;b.show(this._achievementsTemplate,function(d){b.closed=!0,!c&&a&&a(d)});var d=this;this.requestAchievements(function(e,f){if(!b.closed){if(f)return c=!0,void(a&&a(f));var g=[];if(d._cachedAchievements)for(var h=0;h<d._cachedAchievements.length;++h){var i=d._cachedAchievements[h];if(g.push(i),e&&e.length)for(var j=0;j<e.length;++j)if(e[j].achievementID===i.achievementID){i.achieved=!0;break}}var k="addAchievements("+JSON.stringify(g)+");";b.eval(k)}})},setAchievementsMap:function(a){this._achievementsMap=a,this._cachedAchievements&&this.syncAchievementsMap(this._cachedAchievements)},setTemplates:function(a,b){this._leaderboardsTemplate=a,this._achievementsTemplate=b},setCachedAchievements:function(a){this._cachedAchievements=a,a&&this._achievementsMap&&this.syncAchievementsMap(this._cachedAchievements)},findAchievement:function(a){if(!this._cachedAchievements)return null;for(var b=0;b<this._cachedAchievements.length;++b)if(a===this._cachedAchievements[b].achievementID)return this._cachedAchievements[b];return null},translateAchievementID:function(a){if(this._achievementsMap)for(var b in this._achievementsMap)if(b==a)return this._achievementsMap[b];return a},syncAchievementsMap:function(a){if(this._achievementsMap)for(var b=0;b<a.length;++b)for(var c in this._achievementsMap)this._achievementsMap[c]===a[b].achievementID&&(a[b].customID=c)}},Cocoon.extend(a.SocialGamingService,a.Interface),a.ImageSize={THUMB:"thumb",SMALL:"small",MEDIUM:"medium",LARGE:"large"},a.User=function(a,b,c){return this.userID=a,this.userName=b,this.userImage=c,this},a.Message=function(a,b,c,d,e){return this.message=a,this.mediaURL=b,this.linkURL=c,this.linkText=d,this.linkCaption=e,this},a.Score=function(a,b,c,d,e){return this.userID=a,this.score=b||0,this.userName=c,this.imageURL=d,this.leaderboardID=e,this},a.ScoreParams=function(a,b,c,d){this.userID=a,this.leaderboardID=b,this.friends=!!c,this.timeScope=d||2},a.TimeScope={ALL_TIME:0,WEEK:1,TODAY:2},a.Achievement=function(a,b,c,d,e){return this.achievementID=a,this.customID=a,this.title=b,this.description=c,this.imageURL=d,this.points=e||0,this},a.share=function(a){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","share",arguments,!0):void 0},a}),Cocoon.define("Cocoon.Social",function(a){return a.ManagerService=function(){this.services=[]},a.ManagerService.prototype={services:null,registerSocialService:function(a){this.services.push(a)},submitAchievement:function(a){for(var b=0;b<this.services.length;++b){var c=this.services[b];!c.readOnlyHint&&c.isLoggedIn()&&c.submitAchievement(a,function(a){a&&console.error("Error submitting achievement: "+a.message)})}},submitScore:function(a,b){for(var c=0;c<this.services.length;++c){var d=this.services[c];!d.readOnlyHint&&d.isLoggedIn()&&d.submitScore(a,function(a){a&&console.error("Error submitting score: "+a.message)},b)}},getLoggedInServices:function(){for(var a=[],b=0;b<this.services.length;++b){var c=this.services[b];!c.fakeSocialService&&c.isLoggedIn()&&a.push(c)}return a},isLoggedInAnySocialService:function(){return this.getLoggedInServices().length>0}},a.Manager=new a.ManagerService,a}),Cocoon.define("Cocoon.Social",function(a){return a.LocalStorageService=function(){Cocoon.Social.LocalStorageService.superclass.constructor.call(this),this.fakeSocialService=!0},a.LocalStorageService.prototype={loggedIn:!1,keys:{score:"Cocoon.Social.LocalStorageService.score",earnedAchievements:"Cocoon.Social.LocalStorageService.earned"},isLoggedIn:function(){return this.loggedIn},login:function(a){this.loggedIn||this.onLoginStatusChanged.notifyEventListeners(!0),this.loggedIn=!0,a&&setTimeout(function(){a(!0)},0)},logout:function(a){this.loggedIn&&this.onLoginStatusChanged.notifyEventListeners(!0),this.loggedIn=!1,a&&setTimeout(function(){a()},0)},getLoggedInUser:function(){return new Cocoon.Social.User("me","LocalStorage")},requestUser:function(a,b){var c=new Cocoon.Social.User(b||"me","LocalStorage");a&&setTimeout(function(){a(c)},0)},requestScore:function(a,b){var c=localStorage.getItem(this.keys.score),d=parseInt(c)||0;setTimeout(function(){a(new Cocoon.Social.Score("me",d))},0)},submitScore:function(a,b,c){var d=localStorage.getItem(this.keys.score),e=parseInt(d)||0;a>e&&localStorage.setItem(this.keys.score,a),b&&setTimeout(function(){b()},0)},getLocalStorageEarnedAchievements:function(){var a=localStorage.getItem(this.keys.earnedAchievements),b=[];if(a){var c=JSON.stringify(a);c&&c.length&&(b=c)}return b},requestAchievements:function(a,b){var c=this.getLocalStorageEarnedAchievements();setTimeout(function(){a(c)},0)},submitAchievement:function(a,b){if(null===a||"undefined"==typeof a)throw"No achievementID specified";for(var c=this.getLocalStorageEarnedAchievements(),d=!1,e=0;e<c.length;++e)if(c[e]===a){d=!0;break}d||(c.push(a),localStorage.setItem(this.keys.earnedAchievements,JSON.stringify(c))),b&&setTimeout(function(){b()},0)},resetAchievements:function(a){localStorage.removeItem(this.keys.earnedAchievements),a&&setTimeout(function(){a()},0)}},Cocoon.extend(a.LocalStorageService,a.SocialGamingService),a.LocalStorage=new a.LocalStorageService,a}),Cocoon.define("Cocoon.Social",function(a){function b(a,b){return{access_token:a.access_token,state:a.state,error:b,expires_in:a.expirationDate?a.expirationDate-Date.now():0,player_id:a.playerId}}function c(a){return new Cocoon.Social.User(a.playerId,a.displayName,a.avatarImageUrl)}function d(a){var b=a.image?a.image.url:"";return b=b.replace(/sz=\d+/g,"sz=100"),new Cocoon.Social.User(a.id,a.displayName,b)}function e(a){return a===Cocoon.Social.ImageSize.THUMB?100:a===Cocoon.Social.ImageSize.MEDIUM?200:a===Cocoon.Social.ImageSize.LARGE?512:void 0}function f(a){var b=new Cocoon.Social.Achievement(a.id,a.name,a.description,a.revealedIconUrl,0);return b.gpAchievementData=a,b}function g(a,b){return new Cocoon.Social.Score(a.player.playerId,a.scoreValue,a.player.displayName,a.player.avatarImageUrl,b)}return a.GooglePlayGamesExtension=function(){this.nativeExtensionName="IDTK_SRV_GOOGLE_PLAY_GAMES",this.extensionName="Social.GooglePlayGames",this.nativeAvailable=Cocoon.nativeAvailable&&"undefined"!=typeof window.ext[this.nativeExtensionName],this.auth=new Cocoon.Social.GooglePlayGamesAuthExtension(this),this.client=new Cocoon.Social.GooglePlayGamesClientExtension(this),this.defaultScopes=["https://www.googleapis.com/auth/games","https://www.googleapis.com/auth/plus.login"],this.gamesAPI="/games/v1",this.plusAPI="/plus/v1",this.onSessionChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onSessionChanged"),Cocoon.Social.GooglePlayGames=this;var a=this;return this.onSessionChanged.addEventListener(function(c,d){a.token=b(c,d),c&&c.access_token&&a.client.request({path:a.gamesAPI+"/players/me",callback:function(b){a.currentPlayer=b}})}),this},a.GooglePlayGamesExtension.prototype={token:null,settings:{},socialService:null,currentPlayer:null,initialized:!1,auth:null,client:null,init:function(a){if(!a||"object"!=typeof a)throw"Invalid params argument";if(this.settings=a,this.initialized=!0,this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"init",[this.settings.clientId],!0);else{var b=this,c=function(){gapi.auth.authorize({immediate:!0,scope:b.defaultScopes,client_id:b.settings.clientId},function(a){b.token=a,a&&a.access_token&&b.onSessionChanged.notifyEventListeners(a)})};if(window.gapi)c();else{window.onGapiLoadCallback=function(){window.setTimeout(c,1)};var d=document.createElement("script");d.src="https://apis.google.com/js/client.js?onload=onGapiLoadCallback",document.getElementsByTagName("head")[0].appendChild(d)}}},getSocialInterface:function(){if(!this.initialized)throw"You must call init() before getting the Social Interface";return this.socialService||(this.socialService=new Cocoon.Social.SocialGamingServiceGooglePlayGames(this)),this.socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GooglePlayGames},share:function(){return window.open(this.href,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600"),!1}},a.GooglePlayGamesAuthExtension=function(a){return this.extension=a,this},a.GooglePlayGamesAuthExtension.prototype={authorize:function(a,c){var d=this;this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"authorize",[a,function(a,e){d.extension.token=b(a,e),c&&c(d.extension.token)}],!0):gapi.auth.authorize(a,function(a){d.extension.token=a,d.extension.onSessionChanged.notifyEventListeners(a,a?a.error:null),c&&c(a)})},disconnect:function(a){this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"disconnect",[a],!0):a&&a({error:"Not implemented yet"})},init:function(a){this.extension.nativeAvailable?a():gapi.auth.init(a)},getToken:function(){return this.extension.nativeAvailable?this.extension.token:gapi.auth.getToken()},setToken:function(a){this.extension.nativeAvailable?this.extension.token=a:gapi.auth.setToken(a)}},a.GooglePlayGamesClientExtension=function(a){return this.extension=a,this},a.GooglePlayGamesClientExtension.prototype={setApiKey:function(a){this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"setApiKey",[a],!0):gapi.client.setApiKey(a)},request:function(a){if(this.extension.nativeAvailable){if(a.callback)return Cocoon.callNative(this.extension.nativeExtensionName,"request",[a,function(b,c){var d=b;c&&(d=b||{},d.error=c),a.callback(d)}],!0),null;var b=this,c={execute:function(c){Cocoon.callNative(b.extension.nativeExtensionName,"request",[a,function(a,b){var d=a;b&&(d=a||{},d.error=b),c(d)}],!0)}};return c}return gapi.client.request(a)}},a.GooglePlayGames=new Cocoon.Social.GooglePlayGamesExtension,a.SocialGamingServiceGooglePlayGames=function(a){Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.constructor.call(this),this.gapi=a;var b=this;return this.gapi.onSessionChanged.addEventListener(function(a){var c=a||{};b.onLoginStatusChanged.notifyEventListeners(!!c.access_token,c.error)}),this},a.SocialGamingServiceGooglePlayGames.prototype={isLoggedIn:function(){return this.gapi.token&&this.gapi.token.access_token?!0:!1},login:function(a){var b=this;this.gapi.auth.authorize({client_id:this.gapi.settings.clientId,scope:this.gapi.defaultScopes},function(c){a&&a(b.isLoggedIn(),c.error)})},logout:function(a){this.gapi.auth.disconnect(a)},getLoggedInUser:function(){return this.gapi.currentPlayer?fromGPUserToCocoonUser(this.gapi.currentPlayer):null},requestUser:function(a,b){var d=b||"me";this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+d,callback:function(b){var d=b&&!b.error?c(b):null;a(d,b.error)}})},requestUserImage:function(a,b,c){this.requestUser(function(b,d){if(b&&b.userImage){var f=e(c||Cocoon.Social.ImageSize.MEDIUM);-1===b.userImage.indexOf("sz=")?b.userImage+="?sz="+f:b.userImage=b.userImage.replace(/sz=\d+/g,"sz="+f)}a(b?b.userImage:null,d)},b)},requestFriends:function(a,b){var c={orderBy:"best"},e=b||"me";this.gapi.client.request({path:this.gapi.plusAPI+"/people/"+e+"/people/visible",params:c,callback:function(b){if(b&&!b.error){for(var c=[],e=0;e<b.items.length;++e)c.push(d(b.items[e]));a(c)}else a([],b?b.error:null)}})},publishMessage:function(a,b){b&&b("Not supported... use publishMessageWithDialog method instead")},publishMessageWithDialog:function(a,b){if(this.gapi.nativeAvailable){var c={prefilledText:a.message,mediaUrl:a.mediaURL,mediaTitle:a.linkCaption,mediaDescription:a.linkText,url:a.linkURL};Cocoon.callNative(this.gapi.nativeExtensionName,"shareMessage",[c,b],!0)}else{var d=this,e=function(){var b={contenturl:"https://plus.google.com/pages/",contentdeeplinkid:"/pages",clientid:d.gapi.settings.clientId,cookiepolicy:"single_host_origin",prefilltext:a.message,calltoactionlabel:"CREATE",calltoactionurl:"http://plus.google.com/pages/create",calltoactiondeeplinkid:"/pages/create"};gapi.interactivepost.render("sharePost",b)};if(gapi.interactivepost)e();else{var f=document.createElement("script");f.type="text/javascript",f.async=!0,f.src="https://apis.google.com/js/plusone.js",f.onload=function(){e()},document.getElementsByTagName("head")[0].appendChild(f)}}},requestScore:function(a,b){b=b||{};var c=b.userID||"me",d=b.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!d)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+c+"/leaderboards/"+d+"/scores/ALL_TIME",callback:function(b){if(b&&b.error)a(null,b.error);else if(b&&b.items&&b.items.length>0){var d=b.items[0],e=new Cocoon.Social.Score(c,d.scoreValue,"","",d.leaderboard_id);a(e,null)}else a(null,null)}})},submitScore:function(a,b,c){c=c||{};var d=c.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!d)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+d+"/scores",method:"POST",params:{score:a},callback:function(a){b&&b(a?a.error:null)}})},showLeaderboard:function(a,b){b=b||{};var c=b.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!c)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";
var d=/(iPad|iPhone|iPod)/gi.test(navigator.userAgent);if(!d&&this.gapi.nativeAvailable){var e=b.timeScope||0;Cocoon.callNative(this.gapi.nativeExtensionName,"showLeaderboard",[c,e,a],!0)}else{if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";var f=new Cocoon.Widget.WebDialog,h=!1;f.show(this._leaderboardsTemplate,function(b){f.closed=!0,!h&&a&&a(b)});var i=b.friends?"SOCIAL":"PUBLIC",j="ALL_TIME";b.timeScope===Cocoon.Social.TimeScope.WEEK?j="WEEKLY":b.timeScope===Cocoon.Social.TimeScope.TODAY&&(j="DAILY"),this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+c+"/window/"+i,method:"GET",params:{timeSpan:j},callback:function(b){if(!f.closed){if(b.error)return void(a&&(h=!0,a(b.error),f.close()));var d=[],e=[];b&&b.items&&(e=b.items.slice(0)),b&&b.playerScore&&e.push(b.playerScore);for(var i=0;i<e.length;++i){var j=e[i],k=g(j,c);k.imageURL+="?sz=50",k.position=j.scoreRank||i+1,k.me=!1,d.push(k)}var l="addScores("+JSON.stringify(d)+")";f.eval(l)}}})}},prepareAchievements:function(a,b){if(!this._cachedAchievements||a){var c=this;this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements",callback:function(a){if(a&&!a.error){var d=[];if(a&&a.items)for(var e=0;e<a.items.length;e++)d.push(f(a.items[e]));c.setCachedAchievements(d),b(d,null)}else b([],a?a.error:null)}})}else b(this._cachedAchievements,null)},requestAllAchievements:function(a){this.prepareAchievements(!0,a)},requestAchievements:function(a,b){var c=this;this.prepareAchievements(!1,function(d,e){if(e)return void a([],e);var f=b||"me";c.gapi.client.request({path:c.gapi.gamesAPI+"/players/"+f+"/achievements",params:{state:"UNLOCKED"},callback:function(b){if(b&&!b.error){var d=[];if(b.items)for(var e=0;e<b.items.length;e++){var f=c.findAchievement(b.items[e].id);f&&d.push(f)}a(d,null)}else a([],b?b.error:null)}})})},submitAchievement:function(a,b){if(null===a||"undefined"==typeof a)throw"No achievementID specified";var c=this.translateAchievementID(a);if(this.gapi.nativeAvailable){var d=!!this.gapi.settings.showAchievementNotifications;Cocoon.callNative(this.gapi.nativeExtensionName,"unlockAchievement",[c,d,b],!0)}else this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements/"+c+"/unlock",method:"POST",callback:function(a){b&&b(a?a.error:null)}})},resetAchievements:function(a){this.gapi.client.request({path:"/games/v1management/achievements/reset",method:"POST",callback:function(b){a&&a(b?b.error:null)}})},showAchievements:function(a){var b=/(iPad|iPhone|iPod)/gi.test(navigator.userAgent);!b&&this.gapi.nativeAvailable?Cocoon.callNative(this.gapi.nativeExtensionName,"showAchievements",[a],!0):Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.showAchievements.call(this)}},Cocoon.extend(Cocoon.Social.SocialGamingServiceGooglePlayGames,Cocoon.Social.SocialGamingService),a}),Cocoon.define("Cocoon.Social",function(a){function b(a){return new Cocoon.Social.User(a.playerID,a.alias)}function c(a){return new Cocoon.Social.GameCenter.Achievement(a.identifier,a.title,a.achievedDescription,"",a.maximumPoints)}return a.GameCenterExtension=function(){this.nativeExtensionName="IDTK_SRV_GAMECENTER",this.extensionName="Social.GameCenter",this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var a=this;return this.nativeAvailable&&(this.onGameCenterLoginStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onGameCenterLoginStateChanged"),this.onGameCenterLoginStateChanged.addEventListener(function(b,c){a._currentPlayer=b})),this},a.GameCenterExtension.prototype={_currentPlayer:null,getSocialInterface:function(){return this._socialService||(this._socialService=new Cocoon.Social.SocialGamingServiceGameCenter(this)),this._socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GameCenter},isLoggedIn:function(){return this._currentPlayer&&this._currentPlayer.isAuthenticated},login:function(a){var b=this;if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"login",[function(c,d){b._currentPlayer=c,a&&a(c,d)}],!0)},getLocalPlayer:function(){if(this._currentPlayer)return this._currentPlayer;if(this.nativeAvailable)return this._currentPlayer=Cocoon.callNative(this.nativeExtensionName,"getLocalPlayer",[]),this._currentPlayer;throw"Game Center not available"},loadPlayers:function(a,b){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadPlayers",[a,b],!0)},loadFriends:function(a){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadFriends",[a],!0)},loadAchievements:function(a){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadAchievements",[a],!0)},loadAchievementDescriptions:function(a){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadAchievementDescriptions",[a],!0)},loadScores:function(a,b){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadScores",[b,a],!0)},submitScore:function(a,b){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"submitScore",[a,b],!0)},submitAchievements:function(a,b){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"submitAchievements",[a,b],!0)},resetAchievements:function(a){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"resetAchievements",[a],!0)},showAchievements:function(a){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"showAchievements",[a],!0)},showLeaderboards:function(a,b){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"showLeaderboards",[b,a],!0)}},a.GameCenter=new a.GameCenterExtension,a.GameCenter.Player=function(){this.playerID="",this.alias="",this.isFriend=!1},a.GameCenter.LocalPlayer=function(){this.playerID="",this.alias="",this.isAuthenticated=!1},a.GameCenter.Achievement=function(a,b){this.identifier=a,this.percentComplete=b,this.lastReportedDate=0},a.GameCenter.AchievementDescription=function(){this.identifier="",this.title="",this.achievedDescription="",this.unachievedDescription="",this.maximumPoints=0},a.GameCenter.Score=function(a,b,c,d,e,f){return this.userID=a,this.score=b||0,this.userName=c,this.imageURL=d,this.leaderboardID=e,this.rank=f.rank,this.originalScoreObject=f,this},a.GameCenter.Leaderboard=function(a,b,c,d,e,f){this.category=a,this.playerIDs=b,this.timeScope=c,this.playerScope=d,this.rangeStart=e,this.rangeLength=f,this.scores=[],this.localPlayerScore=[],this.localizedTitle=localizedTitle},a.GameCenter.TimeScope={TODAY:0,WEEK:1,ALL_TIME:2},a.GameCenter.PlayerScope={GLOBAL:0,FRIENDS:1},a.SocialGamingServiceGameCenter=function(a){Cocoon.Social.SocialGamingServiceGameCenter.superclass.constructor.call(this),this.gc=a;var b=this;return this.gc.onGameCenterLoginStateChanged.addEventListener(function(a,c){b.onLoginStatusChanged.notifyEventListeners(a.isAuthenticated,c)}),this},a.SocialGamingServiceGameCenter.prototype={_cachedAchievements:null,isLoggedIn:function(){return this.gc.isLoggedIn()},login:function(a){this.gc.login(function(b,c){a&&a(b.isAuthenticated,c)})},logout:function(a){a&&a({message:"User has to logout from the Game Center APP"})},getLoggedInUser:function(){return b(this.gc._currentPlayer?this.gc._currentPlayer:this.gc.getLocalPlayer())},requestUser:function(a,c){if(c)this.gc.loadPlayers([c],function(c,d){var e=c&&c.length?b(c[0]):null;a(e,d)});else{var d=this;setTimeout(function(){a(d.getLoggedInUser())})}},requestFriends:function(a,c){this.gc.loadFriends(function(c,d){var e=[];if(c&&c.length)for(var f=0;f<c.length;++f)e.push(b(c[f]));a(e,d)})},requestScore:function(a,b){var c={},d=b||{};d.leaderboardID&&(c.category=d.leaderboardID),c.playerIDs=[d.userID||this.getLoggedInUser().userID],this.gc.loadScores(function(b,c){var e=null;d.userID&&b&&b.scores&&b.scores.length?e=b.scores[0]:b&&b.localPlayerScore&&(e=b.localPlayerScore);var f=e?new Cocoon.Social.GameCenter.Score(e.playerID,e.value,"","",e.category,e):null;a(f,c)},c)},submitScore:function(a,b,c){var d=c||{};this.gc.submitScore({value:a,category:d.leaderboardID||""},function(a){b&&b(a)})},showLeaderboard:function(a,b){var c=b||{};this.gc.showLeaderboards(function(b){a&&a(b)},{category:c.leaderboardID||""})},prepareAchievements:function(a,b){if(!this._cachedAchievements||a){var d=this;this.gc.loadAchievementDescriptions(function(a,e){if(e)b([],e);else{var f=[];if(a&&a.length)for(var g=0;g<a.length;g++)f.push(c(a[g]));d.setCachedAchievements(f),b(f,null)}})}else b(this._cachedAchievements,null)},requestAllAchievements:function(a){this.prepareAchievements(!0,a)},requestAchievements:function(a,b){var c=this;this.prepareAchievements(!1,function(b,d){return d?void a([],d):void c.gc.loadAchievements(function(b,d){if(d)a([],b.error);else{var e=[];if(b&&b.length)for(var f=0;f<b.length;f++){var g=c.findAchievement(b[f].identifier);g&&e.push(g)}a(e,null)}})})},submitAchievement:function(a,b){if(null===a||"undefined"==typeof a)throw"No achievementID specified";var c=this.translateAchievementID(a);this.gc.submitAchievements([{identifier:c,percentComplete:100}],b)},resetAchievements:function(a){this.gc.resetAchievements(a)},showAchievements:function(a){this.gc.showAchievements(function(b){a&&a(b)})}},Cocoon.extend(a.SocialGamingServiceGameCenter,a.SocialGamingService),a}),Cocoon.define("Cocoon.Social",function(a){function b(a){return 0===a?"connected":1===a?"not_authorized":"unknown"}function c(a,c){var d=null;return 0===a.state&&(d={accessToken:a.accessToken,expirationDate:a.expirationDate,userID:a.user?a.userID:null,permissions:a.permissions,user:a.user}),{status:b(a.state),authResponse:d,error:c}}function d(a){return new Cocoon.Social.User(a.id,a.username?a.username:a.first_name+" "+a.last_name)}function e(a){return{link:a.linkURL,description:a.message,name:a.linkText,caption:a.linkCaption,picture:a.mediaURL}}function f(a,b){var c=new Cocoon.Social.Score(a.user.id,a.score,a.user.name);return b&&(c.leaderboardID=b.leaderboardID),c.imageURL="https://graph.facebook.com/"+a.user.id+"/picture",c}function g(a){var b=new Cocoon.Social.Achievement(a.id,a.title,a.description,a.image[0].url,a.data.points);return b.fbAchievementData=a,b}if(a.FacebookExtension=function(){this.nativeExtensionName="IDTK_SRV_FACEBOOK",this.extensionName="Social.Facebook",this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName],this.Event=new Cocoon.Social.FacebookEvent(this.nativeAvailable);var a=this;return this.nativeAvailable&&(this.onFacebookSessionStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onFacebookSessionStateChanged"),Cocoon.Social.Facebook=this,this.onFacebookSessionStateChanged.addEventListener(function(b,d){var e=c(b,d);0==b.state&&a.Event.notify("auth.login",e),a.Event.notify("auth.authResponseChange",e),a.Event.notify("auth.statusChange",e)})),this},a.FacebookExtension.prototype={_currentSession:null,_appId:null,_socialService:null,init:function(a){if(!a||!a.appId)throw"appId must be specified!";this._appId=a.appId,this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"init",[a],!0):FB.init(a);var b=this;this.Event.subscribe("auth.authResponseChange",function(a){b._currentSession=a,a.authResponse&&!a.authResponse.user&&b.api("me?fields=username",function(a){b._currentSession.authResponse.user=a})})},getSocialInterface:function(){if(!this._appId)throw"You must call init() before getting the Social Interface";return this._socialService||(this._socialService=new Cocoon.Social.SocialGamingServiceFacebook(this)),this._socialService},login:function(a,b){var d=this;this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"login",[b,function(b,e){d._currentSession=c(b,e),a&&a(d._currentSession)}],!0):FB.login(function(b){d._currentSession=b,a&&a(b)},b)},logout:function(a){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"logout",[function(b,d){a&&a(c(b,d))}],!0):FB.logout(function(b){a&&a(b)})},getAuthResponse:function(){if(this.nativeAvailable){var a=Cocoon.callNative(this.nativeExtensionName,"getFacebookSession",[]);return c(a)}return FB.getAuthResponse()},getLoginStatus:function(a,b){if(this.nativeAvailable){var d=this;setTimeout(function(){var b=Cocoon.callNative(d.nativeExtensionName,"getFacebookSession",[]);a&&a(c(b))},50)}else FB.getLoginStatus(a,b)},api:function(a,b,c,d){if(this.nativeAvailable){var e=arguments[0],f=arguments.length>3?arguments[1]:"GET",g=null;3==arguments.length&&(g=arguments[1]),4==arguments.length&&(g=arguments[2]);var h=arguments.length>1?arguments[arguments.length-1]:function(){};return Cocoon.callNative(this.nativeExtensionName,"api",[e,f,g,h],!0)}FB.api(a,b,c,d)},ui:function(a,b){if(this.nativeAvailable){var a=arguments[0],c=arguments.length>1?arguments[1]:function(){};return Cocoon.callNative(this.nativeExtensionName,"ui",[a,c],!0)}navigator.isCocoonJS||FB.ui(a,b)},requestAdditionalPermissions:function(a,b,d){if(this.nativeAvailable){var e=b.split(",");Cocoon.callNative(this.nativeExtensionName,"requestAdditionalPermissions",[a,e,function(a,b){d&&d(c(a,b))}],!0)}else FB.login(d,{scope:b})},getPermissions:function(a){this.api("me/permissions",function(b){a(b.data&&b.data[0]?b.data[0]:{})})},showShareDialog:function(a,b){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"showShareDialog",[a,b],!0):(a.method="feed",FB.ui(a,b))},uploadPhoto:function(a,b){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"uploadPhoto",[a,b],!0):b({error:{message:"Not implemented"}})},showFriendPicker:function(a){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"showFriendPicker",[a],!0):a({error:{message:"Not implemented"}})}},a.FacebookEvent=function(a){return this.nativeAvailable=a,this},a.FacebookEvent.prototype={subscribe:function(a,b){if(this.nativeAvailable){var c=a+"listeners";this[c]=this[c]||[],this[c].push(b)}else navigator.isCocoonJS||FB.Event.subscribe(a,b)},unsubscribe:function(a,b){if(this.nativeAvailable){var c=a+"listeners",d=this[c];if(d){var e=d.indexOf(b);-1!==e&&d.splice(e,1)}}else navigator.isCocoonJS||FB.Event.unsubscribe(a,b)},notify:function(a,b){var c=a+"listeners",d=this[c];if(d)for(var e=0;e<d.length;++e)d[e](b)}},a.Facebook=new a.FacebookExtension,a.SocialGamingServiceFacebook=function(a){Cocoon.Social.SocialGamingServiceFacebook.superclass.constructor.call(this),this.fb=a;var b=this;return this.fb.Event.subscribe("auth.authResponseChange",function(a){b.onLoginStatusChanged.notifyEventListeners("connected"==a.status,a.error)}),this},a.SocialGamingServiceFacebook.prototype={currentPermissions:null,isLoggedIn:function(){return this.fb._currentSession&&"connected"===this.fb._currentSession.status},login:function(a){var b=this;this.fb.login(function(c){a&&a(b.isLoggedIn(),c.error)})},logout:function(a){this.fb.logout(function(b){a&&a(b.error)})},getLoggedInUser:function(){var a=this.fb._currentSession?this.fb._currentSession.authResponse:null;return a&&a.user?d(a.user):a&&a.userID?new Cocoon.Social.Facebook.User(a.userID,"Loading..."):null},hasPublishPermissions:function(a){this.fb.getPermissions(function(b,c){a(b.publish_actions,c)})},requestPublishPermissions:function(a){var b=this;this.fb.requestAdditionalPermissions("publish","publish_actions",function(c){c.error?a(!1,error):b.hasPublishPermissions(function(b,c){a(b,c)})})},requestUser:function(a,b){var c=b||"me";this.fb.api(c,function(b){var c=b.error?null:d(b);a(c,b.error)})},requestUserImage:function(a,b,c){!b&&this.isLoggedIn()&&(b=this.fb._currentSession.authResponse.userID);var d="small";c===Cocoon.Social.ImageSize.THUMB?d="square":c===Cocoon.Social.ImageSize.MEDIUM?d="normal":c===Cocoon.Social.ImageSize.LARGE&&(d="large");var e="https://graph.facebook.com/"+b+"/picture?type="+d;a(e)},requestFriends:function(a,b){var c=(b||"me")+"/friends";this.fb.api(c,function(b){var c=[];if(!b.error)for(var e=0;e<b.data.length;e++)c.push(d(b.data[e]));a(c,b.error)})},preparePublishAction:function(a){if(this.currentPermissions)this.currentPermissions.publish_actions?a(!0):(this.currentPermissions=null,this.fb.requestAdditionalPermissions("publish","publish_actions",function(b){a(b.error?!1:!0)}));else{var b=this;this.fb.getPermissions(function(c){b.currentPermissions=c,c&&b.preparePublishAction(a)})}},publishMessage:function(a,b){this.preparePublishAction(function(c){if(c){var d=e(a),f="me/feed";this.fb.api(f,d,function(a){b&&b(a.error)})}else b&&b({message:"No publish_actions permission granted"})})},publishMessageWithDialog:function(a,b){this.fb.showShareDialog(e(a),function(a){b&&b(a.error)})},requestScore:function(a,b){var c=(b&&b.userID?b.userID:"me")+"/scores";this.fb.api(c,function(b){if(b.error)a(null,b.error);else if(b.data&&b.data.length>0){var c=f(b.data[0]);a(c,null)}else a(null,null)})},submitScore:function(a,b,c){var d=this;this.preparePublishAction(function(e){e?d.requestScore(function(e,f){if(f)return void(b&&b(f));var g=e?e.score:0;if(g>=a)return void(b&&b(null));var h="/"+(c&&c.userID?c.userID:"me")+"/scores";d.fb.api(h,"POST",{score:a},function(a){b&&b(a.error)})},c):b&&b({message:"No publish_actions permission granted"})})},showLeaderboard:function(a,b){if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";var c=new Cocoon.Widget.WebDialog,d=!1;c.show(this._leaderboardsTemplate,function(b){c.closed=!0,!d&&a&&a(b)});var e=this;this.fb.api(e.fb._appId+"/scores",function(b){if(!c.closed){if(b.error)return void(a&&(d=!0,a(b.error),c.close()));var g=[];if(b.data&&b.data.length)for(var h=0;h<b.data.length;++h){var i=f(b.data[h]);i.position=h,i.imageURL="https://graph.facebook.com/"+i.userID+"/picture",i.me=i.userID===e.fb._currentSession.authResponse.userID,g.push(i)}var j="addScores("+JSON.stringify(g)+")";c.eval(j)}})},prepareAchievements:function(a,b){if(!this._cachedAchievements||a){var c=this;this.fb.api(this.fb._appId+"/achievements",function(a){if(a.error)b([],a.error);else{var d=[];if(a.data)for(var e=0;e<a.data.length;e++)d.push(g(a.data[e]));c.setCachedAchievements(d),b(d,null)}})}else b(this._cachedAchievements,null)},requestAllAchievements:function(a){this.prepareAchievements(!0,a)},requestAchievements:function(a,b){var c=this;this.prepareAchievements(!1,function(d,e){if(e)return void a([],e);var f=(b||"me")+"/achievements";c.fb.api(f,function(b){if(b.error)a([],b.error);else{var d=[];if(b.data)for(var e=0;e<b.data.length;e++){var f=c.findAchievement((b.data[e].achievement||b.data[e].data.achievement).id);f&&d.push(f)}a(d,null)}})})},submitAchievement:function(a,b){if(null===a||"undefined"==typeof a)throw"No achievementID specified";var c=this.translateAchievementID(a),d=this;this.preparePublishAction(function(a){a?d.fb.api("me/achievements","POST",{achievement:c},function(a){b&&b(a.error)}):b&&b({message:"No publish_actions permission granted"})})},resetAchievements:function(a){var b=this;this.preparePublishAction(function(c){c?b.requestAchievements(function(c,d){if(d)return void(a&&a(d));for(var e=null,f=c.length,g=0;g<c.length;++g)b.fb.api("me/achievements","DELETE",{achievement:c[g].fbAchievementData.url},function(b){b.error&&(e=b.error),f--,0==f&&a&&a(e)})}):a&&a({message:"No publish_actions permission granted"})})},showAchievements:function(a){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";var b=new Cocoon.Widget.WebDialog,c=!1;b.show(this._achievementsTemplate,function(d){b.closed=!0,!c&&a&&a(d)});var d=this;this.requestAchievements(function(e,f){if(!b.closed){if(f)return c=!0,void(a&&a(f));var g=[];if(d._cachedAchievements)for(var h=0;h<d._cachedAchievements.length;++h){var i=d._cachedAchievements[h];if(g.push(i),e&&e.length)for(var j=0;j<e.length;++j)if(e[j].achievementID===i.achievementID){i.achieved=!0;break}}var k="addAchievements("+JSON.stringify(g)+");";b.eval(k)}})}},Cocoon.extend(a.SocialGamingServiceFacebook,a.SocialGamingService),!(navigator.isCocoonJS||"undefined"!=typeof module&&module.exports)){var h=document.getElementsByTagName("script")[0],i=document.createElement("script"),j=location.protocol?location.protocol:"http:";i.src=j+"//connect.facebook.net/en_US/all.js",h.parentNode.insertBefore(i,h)}return a}),Cocoon.define("Cocoon.Multiplayer",function(a){return a.MultiplayerService=function(a,b){this.nativeExtensionName=a,this.extensionName=b,this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var c=this;this.onInvitationReceived=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationReceived"),this.onInvitationLoaded=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationLoaded",function(a,b){var d=b[0],e=b[1];d&&!e?(c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,c.extensionName,d),a(c.currentMatch,null)):a(null,e)});var d=new Cocoon.Signal.createSignal;return d.register("invitation",{received:this.onInvitationReceived,loaded:this.onInvitationLoaded}),this.on=d.expose(),this},a.MultiplayerService.prototype={currentMatch:null,findMatch:function(a,b){var c=this;this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"findMatch",[a,function(a,d){a&&!d?(c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,c.extensionName,a),b(c.currentMatch,null)):b(null,d)}],!0)},findAutoMatch:function(a,b){var c=this;this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"findAutoMatch",[a,function(a,d){a&&!d?(c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,c.extensionName,a),b(c.currentMatch,null)):b(null,d)}],!0)},cancelAutoMatch:function(){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"cancelAutoMatch",[],!0)},addPlayersToMatch:function(a,b,c){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"addPlayersToMatch",[a,b.matchID,c],!0)},getMatch:function(){return this.currentMatch}},a.Match=function(a,b,c){if("string"!=typeof a)throw"The given native extension name '"+a+"' is not a string.";if("string"!=typeof b)throw"The given extension name '"+a+"' is not a string.";this.nativeExtensionName=a,this.extensionName=b,this.nativeAvailable=Cocoon.nativeAvailable&&"undefined"!=typeof window.ext[a],this.matchID=c;var d=this;this.onMatchDataReceived=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchDataReceived",function(a,b){d.matchID===b[0]&&a(d,b[1],b[2])}),this.onMatchStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchStateChanged",function(a,b){d.matchID===b[0]&&a(d,b[1],b[2])}),this.onMatchConnectionWithPlayerFailed=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchConnectionWithPlayerFailed",function(a,b){d.matchID===b[0]&&a(d,b[1],b[2])}),this.onMatchFailed=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchFailed",function(a,b){d.matchID===b[0]&&a(d,b[1])});var e=new Cocoon.Signal.createSignal;e.register("match",{dataReceived:this.onMatchDataReceived,stateChanged:this.onMatchStateChanged,connectionWithPlayerFailed:this.onMatchConnectionWithPlayerFailed,failed:this.onMatchFailed}),this.on=e.expose()},a.Match.prototype={start:function(){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"startMatch",[this.matchID],!0)},sendDataToAllPlayers:function(a,b){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"sendDataToAllPlayers",[this.matchID,a,b]):void 0},sendData:function(a,b,c){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"sendData",[this.matchID,a,b,c]):void 0},disconnect:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"disconnect",[this.matchID],!0):void 0},requestPlayersInfo:function(a){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"requestPlayersInfo",[this.matchID,a],!0):void 0},getExpectedPlayerCount:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getExpectedPlayerCount",[this.matchID]):void 0},getPlayerIDs:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getPlayerIDs",[this.matchID]):void 0},getLocalPlayerID:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getLocalPlayerID",[this.matchID]):""}},a.SendDataMode={RELIABLE:0,UNRELIABLE:1},a.ConnectionState={UNKNOWN:0,CONNECTED:1,DISCONNECTED:2},a.PlayerInfo=function(a,b){this.userID=a,this.userName=b},a.MatchRequest=function(a,b,c,d,e){return this.minPlayers=a,this.maxPlayers=b,this.playersToInvite=c,this.playerGroup=d,this.playerAttributes=e,this},a}),Cocoon.define("Cocoon.Multiplayer",function(a){var b=[],c=0,d=[],e=0;a.LoopbackService=function(){Cocoon.Multiplayer.LoopbackService.superclass.constructor.call(this,"dummy","dummy"),b.push(this),this.playerID=""+c,c++},a.LoopbackService.prototype={findMatch:function(a,b){this.findMatchCallback=b;for(var c=!1,e=0;e<d.length;++e)if(d[e]===this){c=!0;break}if(c||d.push(this),d.length>=a.minPlayers){for(var g=[],e=0;e<d.length;++e)g.push(d[e].getPlayerID());for(var e=0;e<d.length;++e){var h=new f(d[e]);h.playerIDs=g.slice(),d[e].currentMatch=h,d[e].findMatchCallback(h,null)}d=[]}},findAutoMatch:function(a,b){this.findMatch(a,b)},cancelAutoMatch:function(){},addPlayersToMatch:function(a,b,c){c({message:"Not implemmented"})},getPlayerID:function(){return this.playerID},getMatch:function(){return this.currentMatch}},Cocoon.extend(a.LoopbackService,a.MultiplayerService);var f=function(a){e++,f.superclass.constructor.call(this,"","",e),this.started=!1,this.disconnected=!1,this.pendingData=[],this.service=a};return f.prototype={start:function(){var a=this;setTimeout(function(){a.started=!0;for(var b=0;b<a.pendingData.length;++b)a.onMatchDataReceived.notifyEventListeners(a.matchID,a.pendingData[b].data,a.pendingData[b].player)},0)},sendDataToAllPlayers:function(a,b){this.sendData(a,this.playerIDs,b)},sendData:function(a,c,d){var e=this;setTimeout(function(){for(var d=0;d<b.length;++d){for(var f=null,g=0;g<c.length;++g)c[g]===b[d].getPlayerID()&&(f=b[d]);f&&f.getMatch().notifyDataReceived(a,e.service.getPlayerID())}},0)},disconnect:function(){this.disconnected=!0;for(var a=0;a<this.playerIDs.length;++a)for(var c=this.playerIDs[a],d=0;d<b.length;++d)if(b[d].getPlayerID()===c){var e=b[a].getMatch();e.disconnected||e.onMatchStateChanged.notifyEventListeners(e,this.service.getPlayerID(),Cocoon.Multiplayer.ConnectionState.DISCONNECTED)}},requestPlayersInfo:function(a){var b=this;setTimeout(function(){for(var c=[],d=0;d<b.playerIDs.length;++d)c[d]={userID:b.playerIDs[d],userName:"Player"+b.playerIDs[d]};a(c)},1)},getExpectedPlayerCount:function(){return 0},getPlayerIDs:function(){return this.playerIDs},getLocalPlayerID:function(){return this.service.playerID},notifyDataReceived:function(a,b){this.started?this.onMatchDataReceived.notifyEventListeners(this.matchID,a,b):this.pendingData.push({data:a,player:b})}},Cocoon.extend(f,Cocoon.Multiplayer.Match),a}),Cocoon.define("Cocoon.Multiplayer",function(a){return a.GooglePlayGames=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GPG","Multiplayer.GooglePlayGames"),a}),Cocoon.define("Cocoon.Multiplayer",function(a){return a.GameCenter=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GAMECENTER","Multiplayer.GameCenter"),a}),function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports={img:["dust.png"],sound:[],font:[]}},{}],2:[function(a,b,c){b.exports=function(){throw Error("[BaseClass] Abstract method was called without definition.")}},{}],3:[function(a,b,c){function d(a){return a=a||{},a.extend=function(b){var c,d={base:a.base};b=b||{};for(c in a)"function"==typeof a[c]&&(d[c]=a[c].bind(a));for(c in b)"function"==typeof b[c]?a[c]=e(c,a,d,b):a[c]=b[c];return a.base=d,"_create"in b?a._create():a._create=f,a},a.implement=function(){var b,c=arguments.length;for(b=0;c>b;b+=1)arguments[b](a);return a},"_create"in a?a._create.call(a):a._create=f,a}var e=a("./rebind.js"),f=a("./stub.js");d.Abstract=a("./abstract.js"),d.Stub=f,d.Interface=a("./interface.js"),b.exports=d},{"./abstract.js":2,"./interface.js":4,"./rebind.js":5,"./stub.js":6}],4:[function(a,b,c){b.exports=function(a){return function(b){var c;for(c in a)b[c]=a[c];return b}}},{}],5:[function(a,b,c){b.exports=function(a,b,c,d){return function(){var e,f=b.base;return b.base=c,b.self=d,e=d[a].apply(b,arguments),b.base=f,e}}},{}],6:[function(a,b,c){b.exports=function(){}},{}],7:[function(a,b,c){b.exports=function(){var a,b=arguments[0],c=arguments.length;for(a=1;c>a;a+=1)b=b.replace(/%s/,arguments[a]);return b}},{}],8:[function(a,b,c){(function(c){var d=a("./geom/dimension.js"),e=a("./geom/point.js"),f=a("./assets/pipeline.js"),g=a("./util/object.js");b.exports=function(a,b){var h,i,j=f.get.image(a),k=0,l=!1,m=1;return b=g.mergeDefaults(b,{kind:"dragon-animation-strip",sinusoid:!1,start:e(),frames:1}),b.size=b.size||d(j.width/b.frames,j.height),i=e(b.size.width*b.start.x,b.size.height*b.start.y),{size:b.size,frame:0,speed:b.speed||0,start:function(){h=c.Date.now(),l=this.speed>0},pause:function(){l=!1},stop:function(){k=0,this.frame=0,m=1,l=!1},update:function(){var a,b,d;d=1/this.speed*1e3,a=c.Date.now(),b=a-h,k+=b,k>=d&&(k=0,this.nextFrame()),h=a},nextFrame:function(){return this.frame+=m,b.sinusoid?this.frame%(b.frames-1)===0&&(m*=-1):this.frame%=b.frames,this.frame},draw:function(a,b){var c=this.frame*b.width;a.drawImage(j,i.x+c,i.y,this.size.width,this.size.height,-b.width/2,-b.height/2,b.width,b.height)}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./assets/pipeline.js":12,"./geom/dimension.js":22,"./geom/point.js":23,"./util/object.js":52}],9:[function(a,b,c){b.exports=function(a,b){var c=document.createElement("audio"),d=c.play;return c.onloadeddata=b,c.loop=!1,c.volume=1,c.play=function(a){a&&(this.currentTime=0),d.call(this)},c.stop=function(){this.pause(),this.currentTime=0},c.onplay=function(){},c.onplaying=function(){},c.onended=function(){},c.src="assets/sound/"+a,c}},{}],10:[function(a,b,c){(function(c){var d=a("curb");b.exports=function(a,b){var e=c.document.createElement("style");return e.innerHTML=d("@font-face{%s}",["font-family:"+a,"font-style:"+(b.style||"normal"),"font-weight:"+(b.weight||400),"src:url(assets/font/"+b.src+")"].join(";")),c.document.body.appendChild(e),!0}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{curb:7}],11:[function(a,b,c){b.exports=function(a,b){var c=new Image;return c.onload=b,c.src="assets/img/"+a,c}},{}],12:[function(a,b,c){var d=(a("../util/object.js"),a("./image.js")),e=a("./audio.js"),f=a("./font.js"),g=(a("../game.js"),a("../heartbeat.js")),h=a("../../../../assets/directory.json"),i=!1,j=0,k=function(){},l=function(){j-=1,0===j&&k()},m={image:{},sound:{},font:{}};b.exports={load:function(a){a=a||function(){},i||(i=!0,k=function(){a(),g.run()},j+=h.img.length,j+=h.sound.length,j?(h.img.forEach(this.add.image),h.sound.forEach(this.add.sound)):k())},get ready(){return 0===j},get:{image:function(a){return m.image[a]},sound:function(a){return m.sound[a]}},add:{image:function(a){return a in m.image||(m.image[a]=d(a,l)),m.image[a]},sound:function(a){return a in m.sound||(m.sound[a]=e(a,l)),
m.sound[a]},font:function(a,b){return a in m.font||(m.font[a]=f(a,b)),!0}}}},{"../../../../assets/directory.json":1,"../game.js":20,"../heartbeat.js":29,"../util/object.js":52,"./audio.js":9,"./font.js":10,"./image.js":11}],13:[function(a,b,c){var d=a("./collision-item.js"),e=a("./geom/point.js"),f=a("./geom/vector.js"),g=a("./geom/dimension.js"),h=a("./geom/rectangle.js"),i=a("./util/object.js"),j=a("./util/number.js");b.exports=function(a){var b=a.pos||e(),c=a.size||g(),k=a.scale||1,l=c.multiply(g(k,k));return a=i.mergeDefaults(a,{name:"dragon-clear-sprite",kind:"dragon-clear-sprite",mask:h()}),a.freemask||(a.offset=a.mask.pos(),a.mask.move(b.add(a.offset)),a.mask.width||a.mask.height||a.mask.resize(c)),d(a).extend({gravity:a.gravity||0,friction:a.friction||0,pos:b,alpha:a.alpha||1,scale:function(b){return b?(k=b,l=c.multiply(g(k,k)),l.floor(!0),a.freemask||this.mask.resize(l),void 0):k},size:function(b){return b?(c=b,l=c.multiply(g(k,k)),l.floor(!0),a.freemask||this.mask.resize(l),void 0):l},rotation:a.rotation||0,rotationSpeed:a.rotationSpeed||0,speed:a.speed||f(),update:function(){this.rotationSpeed*=1-this.friction,this.rotation+=this.rotationSpeed,this.rotation%=j.PI2,this.speed.y+=this.gravity,this.speed.is.zero||(this.speed.x*=1-this.friction,this.speed.y*=1-this.friction,this.shift()),this.base.update()},draw:function(a){var b=j.sin(this.rotation),c=j.cos(this.rotation);a.globalAlpha=this.alpha,a.setTransform(c,b,-b,c,this.pos.x,this.pos.y),a.moveTo(l.width,0)},move:function(b){this.pos.move(b,!0),a.freemask||this.base.move(this.pos)},shift:function(a){this.move(this.pos.add(a||this.speed))}})}},{"./collision-item.js":16,"./geom/dimension.js":22,"./geom/point.js":23,"./geom/rectangle.js":25,"./geom/vector.js":27,"./util/number.js":51,"./util/object.js":52}],14:[function(a,b,c){var d=a("./item.js"),e=a("./util/object.js");b.exports=function(a){var b=!1;return a=e.mergeDefaults(a,{name:"dragon-collection",kind:"dragon-collection"}),d(a).extend({sorted:"sorted"in a?a.sorted:!0,set:[],map:{},add:function(a){return a&&(a=[].concat(a),a.forEach(function(a){a.removed=!1,this.set.push(a),this.map[a.name]=a,a.trigger("$added")},this),this.sorted&&this.set.sort(function(a,b){return a.depth-b.depth})),this},remove:function(a){a.removed=!0,b=!0},clear:function(){this.set=[],this.map={}},get:function(a){return this.map[a]},update:function(){this.set.forEach(function(a){this.updating&&a.updating&&!a.removed&&a.update()},this)},draw:function(a){this.set.forEach(function(b){this.drawing&&b.drawing&&!b.removed&&(a.globalAlpha=1,b.draw(a))},this)},teardown:function(){this.set.forEach(function(a){this.updating&&a.updating&&!a.removed&&a.teardown()},this),b&&(this.set=this.set.filter(function(a){return!a.removed}),b=!1)}})}},{"./item.js":35,"./util/object.js":52}],15:[function(a,b,c){var d=a("./util/object.js"),e=a("./item.js");b.exports=function(a){var b=[];return a=d.mergeDefaults(a,{name:"dragon-collision-handler",kind:"dragon-collision-handler"}),e(a).extend({draw:function(a){b.forEach(function(b){b.mask.draw(a)})},clearCollisions:function(){b=[]},update:function(a){b.push(a)},handleCollisions:function(){b.forEach(function(a){b.forEach(function(b){var c,d,e=a.canCollideWith(b.id);e&&(c=a.intersects(b.mask),d=a.isCollidingWith(b.id),c?(a.addCollision(b.id),d||(a.trigger("$collide#"+b.name,b),a.trigger("$collide."+b.kind,b)),a.trigger("$colliding#"+b.name,b),a.trigger("$colliding."+b.kind,b)):(a.removeCollision(b.id),d&&(a.trigger("$separate#"+b.name,b),a.trigger("$separate."+b.kind,b)),a.trigger("$miss#"+b.name,b),a.trigger("$miss."+b.kind,b)))})})},teardown:function(){this.clearCollisions()}})}},{"./item.js":35,"./util/object.js":52}],16:[function(a,b,c){(function(c){var d=a("./util/id-counter.js"),e=a("./geom/rectangle.js"),f=a("./geom/vector.js"),g=a("./item.js"),h=a("./io/mouse.js"),i=a("./io/canvas.js"),j=a("./util/object.js");b.exports=function(a){var b={},k={},l=!1,m=[].concat(a.collisions||[]);return a=j.mergeDefaults(a,{name:"dragon-collidable",kind:"dragon-collidable",on:{}}),a.on["collide#screendrag"]=[].concat(a.on["collide#screendrag"]||[],function(){this.dragging||(this.dragging=!0,h.on.up(function(){this.dragging=!1},this))}),g(a).extend({id:d.nextId,dragging:!1,mask:a.mask||e(),offset:a.offset||f(),onscreen:function(){return this.intersects(i.mask)},move:function(a){this.mask.move(a.add(this.offset))},flush:function(a){var b=this.mask.bottom-a.mask.top,d=a.mask.right-this.mask.left,e=a.mask.bottom-this.mask.top,f=this.mask.right-a.mask.left,g=c.Math.min(b,d,e,f),h=this.pos.clone();switch(g){case b:h.y=a.mask.y-this.mask.height;break;case d:h.x=a.mask.right;break;case e:h.y=a.mask.bottom;break;default:h.x=a.mask.x-this.mask.width}this.move(h)},intersects:function(a){return this.mask.intersects(a)},update:function(){l||(l=!0,m.forEach(function(a){a.update(this)},this))},teardown:function(){l=!1,k={}},addCollision:function(a){b[a]=!0,k[a]=!0},removeCollision:function(a){b[a]=!1},clearCollisions:function(){b={}},isCollidingWith:function(a){return b[a]||!1},canCollideWith:function(a){var b=this.id===a,c=k[a];return!b&&!c}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./geom/rectangle.js":25,"./geom/vector.js":27,"./io/canvas.js":32,"./io/mouse.js":34,"./item.js":35,"./util/id-counter.js":50,"./util/object.js":52}],17:[function(a,b,c){var d=a("./game.js"),e=a("./util/set.js"),f=a("./util/object.js"),g=(a("./heartbeat.js"),a("./assets/pipeline.js"));b.exports={Shape:a("./geom/shape.js"),Circle:a("./geom/circle.js"),Rectangle:a("./geom/rectangle.js"),Dimension:a("./geom/dimension.js"),Point:a("./geom/point.js"),Vector:a("./geom/vector.js"),Polar:a("./geom/polar.js"),FrameCounter:a("./util/frame-counter.js"),IdCounter:a("./util/id-counter.js"),timer:a("./util/timer.js"),random:a("./util/random.js"),range:e.range,shuffle:e.shuffle,mergeLeft:f.mergeLeft,mergeDefaults:f.mergeDefaults,Mouse:a("./io/mouse.js"),Key:a("./io/keyboard.js"),canvas:a("./io/canvas.js"),loadAssets:g.load.bind(g),addFont:g.add.font,image:g.get.image,sound:g.get.audio,AnimationStrip:a("./animation-strip.js"),CollisionHandler:a("./collision-handler.js"),collisions:a("./dragon-collisions.js"),debug:d.useDebug,screen:d.screen,sprite:d.sprite,addScreens:d.addScreens,removeScreen:d.removeScreen,Screen:a("./screen.js"),CollisionItem:a("./collision-item.js"),Sprite:a("./sprite.js"),ClearSprite:a("./clear-sprite.js"),ui:{Button:a("./ui/button.js"),Label:a("./ui/label.js")},fadeable:a("./interface/fadeable.js"),Eventable:a("./interface/eventable.js"),particle:{Emitter:a("./particle/emitter.js"),Square:a("./particle/square.js"),Circle:a("./particle/circle.js"),Image:a("./particle/image.js")}}},{"./animation-strip.js":8,"./assets/pipeline.js":12,"./clear-sprite.js":13,"./collision-handler.js":15,"./collision-item.js":16,"./dragon-collisions.js":18,"./game.js":20,"./geom/circle.js":21,"./geom/dimension.js":22,"./geom/point.js":23,"./geom/polar.js":24,"./geom/rectangle.js":25,"./geom/shape.js":26,"./geom/vector.js":27,"./heartbeat.js":29,"./interface/eventable.js":30,"./interface/fadeable.js":31,"./io/canvas.js":32,"./io/keyboard.js":33,"./io/mouse.js":34,"./particle/circle.js":40,"./particle/emitter.js":41,"./particle/image.js":42,"./particle/square.js":43,"./screen.js":44,"./sprite.js":45,"./ui/button.js":46,"./ui/label.js":47,"./util/frame-counter.js":49,"./util/id-counter.js":50,"./util/object.js":52,"./util/random.js":53,"./util/set.js":54,"./util/timer.js":55}],18:[function(a,b,c){var d=a("./collision-handler.js");b.exports=d({name:"dragon"})},{"./collision-handler.js":15}],19:[function(a,b,c){var d=a("./collection.js"),e=a("./collision-item.js"),f=a("./geom/rectangle.js"),g=a("./geom/point.js"),h=a("./geom/dimension.js"),i=a("./io/canvas.js"),j=a("./dragon-collisions.js");b.exports=d({name:"dragon-masks"}).add([a("./mask/screentap.js"),a("./mask/screendrag.js"),a("./mask/screenhold.js"),e({name:"screenedge/top",mask:f(g(0,-20),h(i.width,20)),collisionSets:j}),e({name:"screenedge/right",mask:f(g(i.width,0),h(20,i.height)),collisionSets:j}),e({name:"screenedge/bottom",mask:f(g(0,i.height),h(i.width,20)),collisionSets:j}),e({name:"screenedge/left",mask:f(g(-20,0),h(20,i.height)),collisionSets:j})])},{"./collection.js":14,"./collision-item.js":16,"./dragon-collisions.js":18,"./geom/dimension.js":22,"./geom/point.js":23,"./geom/rectangle.js":25,"./io/canvas.js":32,"./mask/screendrag.js":36,"./mask/screenhold.js":37,"./mask/screentap.js":38}],20:[function(a,b,c){var d=a("./util/frame-counter.js"),e=a("./collection.js"),f=a("./util/timer.js"),g=a("./io/canvas.js").ctx,h=a("./dragon-collisions.js"),i=a("./dragon-masks.js");b.exports=e({name:"dragon-game"}).extend({debug:!1,useDebug:function(){this.debug=!0},update:function(){i.update(),this.base.update(),f.update(),h.handleCollisions()},draw:function(){this.base.draw(g),this.debug&&(d.draw(g),h.draw(g))},teardown:function(){h.teardown(),i.teardown(),this.base.teardown()},screen:function(a){return this.base.get(a)},addScreens:function(a){this.base.add(a)},removeScreen:function(a){this.base.remove(a)}})},{"./collection.js":14,"./dragon-collisions.js":18,"./dragon-masks.js":19,"./io/canvas.js":32,"./util/frame-counter.js":49,"./util/timer.js":55}],21:[function(a,b,c){(function(c){var d=a("./shape.js"),e=a("./vector.js"),f=a("./point.js"),g=(a("./dimension.js"),a("../util/number.js"));b.exports=function(a,b){return a=a||f(),b=b||0,d({pos:a,name:"circle",intersects:{rectangle:function(a){var b,c=f(this.x,this.y);return this.x>=a.right?c.x=a.right:this.x<=a.x&&(c.x=a.x),this.y>=a.bottom?c.y=a.bottom:this.y<=a.y&&(c.y=a.y),b=e(this.x-c.x,this.y-c.y),b.magnitude<this.radius},circle:function(a){var b=e(a.x-this.x,a.y-this.y);return b.magnitude<this.radius+a.radius}}}).extend({radius:b,width:2*b,height:2*b,top:a.y-b,right:a.x+b,bottom:a.y+b,left:a.x-b,center:function(){return f(this.x,this.y)},draw:function(a){a.beginPath(),a.lineWidth=1,a.globalAlpha=.5,a.strokeStyle="#f55",a.arc(this.x,this.y,this.radius,0,2*g.PI),a.stroke()},move:function(a){this.x=a.x,this.y=a.y,this.top=a.y-this.radius,this.right=a.x+this.radius,this.bottom=a.y+this.radius,this.left=a.x-this.radius},resize:function(a){var b=c.Math.max(a.width,a.height);this.radius=b,this.width=2*b,this.height=2*b,this.top=this.y-b,this.right=this.x+b,this.bottom=this.y+b,this.left=this.x-b}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util/number.js":51,"./dimension.js":22,"./point.js":23,"./shape.js":26,"./vector.js":27}],22:[function(a,b,c){(function(c){var d=a("./zero.js");b.exports=function(a,e){var f={width:a||0,height:e||0,clone:function(){return b.exports(this.width,this.height)},equals:function(a){return this.width===a.width&&this.height===a.height},floor:function(a){var b=a?this:this.clone();return b.width=c.Math.floor(b.width),b.height=c.Math.floor(b.height),b},is:{get zero(){return f.equals(d)}},multiply:function(a,b){var c=b?this:this.clone();return c.width*=a.width,c.height*=a.height,c},divide:function(a,b){var c=b?this:this.clone();return c.width/=a.width,c.height/=a.height,c},add:function(a,b){var c=b?this:this.clone();return c.width+=a.width,c.height+=a.height,c},subtract:function(a,b){var c=b?this:this.clone();return c.width-=a.width,c.height-=a.height,c}};return f}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./zero.js":28}],23:[function(a,b,c){(function(c){var d=a("./zero.js");b.exports=function(a,e){var f={x:a||0,y:e||0,clone:function(){return b.exports(this.x,this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},floor:function(a){var b=a?this:this.clone();return b.x=c.Math.floor(b.x),b.y=c.Math.floor(b.y),b},is:{get zero(){return f.equals(d)}},move:function(a,b){var c=b?this:this.clone();return c.x=a.x,c.y=a.y,c},multiply:function(a,b){var c=b?this:this.clone();return c.x*=a.x,c.y*=a.y,c},divide:function(a,b){var c=b?this:this.clone();return c.x/=a.x,c.y/=a.y,c},add:function(a,b){var c=b?this:this.clone();return c.x+=a.x,c.y+=a.y,c},subtract:function(a,b){var c=b?this:this.clone();return c.x-=a.x,c.y-=a.y,c}};return f}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./zero.js":28}],24:[function(a,b,c){function d(a,b,c,d){var f=a.magnitude===d*b.magnitude,g=(a.theta%e.PI).toFixed(5),h=((b.theta+c)%e.PI).toFixed(5);return f&&g===h}var e=a("../util/number.js");b.exports=function(c,f){return{theta:c||0,magnitude:f||0,invert:function(){return b.exports(this.theta+e.PI,-1*this.magnitude)},clone:function(){return b.exports(this.theta,this.magnitude)},toVector:function(){var b=a("./vector.js");return b(this.magnitude*e.cos(this.theta),this.magnitude*e.sin(this.theta))},equals:function(a){return d(this,a,0,1)||d(this,a,e.PI,-1)}}}},{"../util/number.js":51,"./vector.js":27}],25:[function(a,b,c){var d=a("./shape.js"),e=a("./point.js"),f=a("./dimension.js"),g=a("./vector.js");b.exports=function(a,b){return a=a||e(),b=b||f(),d({pos:a,name:"rectangle",intersects:{rectangle:function(a){return this.x<a.right&&this.right>a.x&&this.y<a.bottom&&this.bottom>a.y},circle:function(a){var b,c=e(a.x,a.y);return a.x>this.right?c.x=this.right:a.x<this.x&&(c.x=this.x),a.y>this.bottom?c.y=this.bottom:a.y<this.y&&(c.y=this.y),b=g(a.x-c.x,a.y-c.y),b.magnitude<a.radius}}}).extend({width:b.width||0,height:b.height||0,top:a.y||0,right:a.x+b.width||0,bottom:a.y+b.height||0,left:a.x||0,center:function(){return e(this.x+this.width/2,this.y+this.height/2)},move:function(a){this.x=a.x,this.y=a.y,this.top=a.y,this.right=a.x+this.width,this.bottom=a.y+this.height,this.left=a.x},shift:function(a){this.move(this.pos().add(a))},resize:function(a){this.width=a.width,this.height=a.height,this.right=this.x+a.width,this.bottom=this.y+a.height},draw:function(a){a.beginPath(),a.lineWidth=1,a.globalAlpha=.5,a.strokeStyle="#f55",a.rect(this.x,this.y,this.width,this.height),a.stroke()}})}},{"./dimension.js":22,"./point.js":23,"./shape.js":26,"./vector.js":27}],26:[function(a,b,c){var d=a("baseclassjs"),e=a("./point.js");b.exports=function(a){var b,c;return a=a||{},c=a.intersects||{},b=a.pos||e(),d({x:b.x,y:b.y,width:0,height:0,top:0,right:0,bottom:0,left:0,pos:function(){return e(this.x,this.y)},name:a.name,move:d.Abstract,resize:d.Abstract,intersects:function(a){return c[a.name].call(this,a)},draw:d.Stub})}},{"./point.js":23,baseclassjs:3}],27:[function(a,b,c){(function(c){var d=a("./zero.js"),e=a("../util/number.js");b.exports=function(f,g){var h={x:f||0,y:g||0,get magnitude(){return e.abs(c.Math.sqrt(this.y*this.y+this.x*this.x))},clone:function(){return b.exports(this.x,this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},is:{get zero(){return h.equals(d)}},toPolar:function(){var b=a("./polar.js");return b(c.Math.atan(this.y/this.x),this.magnitude)},multiply:function(a){return this.x*=a.x,this.y*=a.y,this},divide:function(a){return this.x/=a.x,this.y/=a.y,this},add:function(a){return this.x+=a.x,this.y+=a.y,this},subtract:function(a){return this.x-=a.x,this.y-=a.y,this}};return h}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util/number.js":51,"./polar.js":24,"./zero.js":28}],28:[function(a,b,c){b.exports={x:0,y:0,right:0,left:0,top:0,bottom:0,width:0,height:0}},{}],29:[function(a,b,c){(function(c){var d=a("./game.js"),e=a("./util/frame-counter.js"),f=!1;b.exports={run:function(){function a(b){d.update(b),d.draw(),d.teardown(),e.countFrame(b),c.requestAnimationFrame(a)}f||(f=!0,c.requestAnimationFrame(a))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./game.js":20,"./util/frame-counter.js":49}],30:[function(a,b,c){var d=a("baseclassjs");b.exports=function(a){var b,c={},e={};a=a||{};for(b in a.events)c[b]=[].concat(a.events[b]);for(b in a.singles)e[b]=[].concat(a.singles[b]);return d.Interface({on:function(a,b){c[a]=c[a]||[],c[a].push(b)},one:function(a,b){e[a]=e[a]||[],e[a].push(b)},off:function(a){c[a]=[],e[a]=[]},trigger:function(a,b){a in c&&c[a].forEach(function(a){a.call(this,b)},this),a in e&&(e[a].forEach(function(a){a.call(this,b)},this),e[a]=[])}})}},{baseclassjs:3}],31:[function(a,b,c){var d=a("baseclassjs");b.exports=d.Interface({fadeIn:function(){},fadeOut:function(){}})},{baseclassjs:3}],32:[function(a,b,c){(function(c){var d=a("../geom/rectangle.js"),e=a("../geom/point.js"),f=a("../geom/dimension.js"),g=a("../util/detect-mobile.js"),h=c.document.createElement("canvas");g?(h.width=c.innerWidth,h.height=c.innerHeight):("landscape"===c.localStorage.drago?(h.width=480,h.height=320):(h.width=320,h.height=480),h.style.border="1px solid #000"),c.document.body.appendChild(h),h.mobile=g,h.ctx=h.getContext("2d"),h.ctx.resetTransform||(h.ctx.resetTransform=function(){h.ctx.setTransform(1,0,0,1,0,0)}),h.clear=function(){h.ctx.clearRect(0,0,h.width,h.height)},h.mask=d(e(0,0),f(h.width,h.height)),h.center=e(h.width/2,h.height/2),c.Cocoon.Utils.setAntialias(!1),h.ctx.imageSmoothingEnabled=!1,b.exports=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../geom/dimension.js":22,"../geom/point.js":23,"../geom/rectangle.js":25,"../util/detect-mobile.js":48}],33:[function(a,b,c){function d(a){return a.charCode||a.keyCode||a.which}var e={alt:!1,ctrl:!1,shift:!1},f={};document.onkeydown=function(a){var b=d(a),c=String.fromCharCode(b);f[b]=!0,e[c]=!0,e.alt=a.altKey,e.ctrl=a.ctrlKey,e.shift=a.shiftKey},document.onkeyup=function(a){var b=d(a),c=String.fromCharCode(b);f[b]=!1,e[c]=!1,e.alt=a.altKey,e.ctrl=a.ctrlKey,e.shift=a.shiftKey},b.exports={get alt(){return e.alt},get ctrl(){return e.ctrl},get shift(){return e.shift},arrow:{get left(){return f[37]||!1},get up(){return f[38]||!1},get right(){return f[39]||!1},get down(){return f[40]||!1}},name:function(a){return e[a]||!1},code:function(a){return f[a]||!1}}},{}],34:[function(a,b,c){function d(a){return j.mobile?h(a.touches[0].clientX,a.touches[0].clientY):h(a.offsetX,a.offsetY)}var e,f,g,h=a("../geom/point.js"),i=a("../geom/vector.js"),j=a("./canvas.js"),k=a("../util/timer.js"),l=null,m=!1,n=!1,o=!1,p=h(),q=h(),r=i();j.mobile?(e="touchstart",f="touchmove",g="touchend"):(e="mousedown",f="mousemove",g="mouseup"),j.addEventListener(e,function(a){m=!0,p=d(a),k.setTimeout(function(){m&&(o=!0)},200)}),document.addEventListener(g,function(a){m=n=o=!1,l=null}),j.addEventListener(f,function(a){q=p,p=d(a),m&&!n&&(r.x=p.x-q.x,r.y=p.y-q.y,r.magnitude>1&&(n=!0,l=p))}),b.exports={is:{get down(){return m},get dragging(){return n},get holding(){return o}},get offset(){return p},get dragStart(){return l},on:{down:function(a,b){j.addEventListener(e,a.bind(b))},click:function(a,b){},dclick:function(a,b){},up:function(a,b){document.addEventListener(g,a.bind(b))},move:function(a,b){j.addEventListener(f,a.bind(b))},drag:function(a,b){j.addEventListener(f,function(){n&&a.call(b)})},swipe:function(a,b,c){}},eventName:{start:e,move:f,end:g}}},{"../geom/point.js":23,"../geom/vector.js":27,"../util/timer.js":55,"./canvas.js":32}],35:[function(a,b,c){var d=a("baseclassjs"),e=a("./interface/eventable.js");b.exports=function(a){return a=a||{},d({name:a.name||"dragon-item",kind:a.kind||"dragon-item",depth:0,removed:!1,updating:"updating"in a?a.updating:!0,drawing:"drawing"in a?a.drawing:!0,update:d.Stub,draw:d.Stub,teardown:d.Stub,start:function(){this.updating=!0,this.drawing=!0,this.trigger("$start")},pause:function(){this.updating=!1,this.drawing=!0,this.trigger("$pause")},stop:function(){this.updating=!1,this.drawing=!1,this.trigger("$stop")}}).implement(e({events:a.on,singles:a.one}))}},{"./interface/eventable.js":30,baseclassjs:3}],36:[function(a,b,c){var d=a("../collision-item.js"),e=a("../geom/circle.js"),f=a("../geom/point.js"),g=a("../io/mouse.js"),h=a("../dragon-collisions.js");b.exports=d({name:"screendrag",mask:e(f(),8),collisions:h}).extend({update:function(){g.is.dragging?this.move(g.offset):this.move(f(-999,-999)),this.base.update()}})},{"../collision-item.js":16,"../dragon-collisions.js":18,"../geom/circle.js":21,"../geom/point.js":23,"../io/mouse.js":34}],37:[function(a,b,c){var d=a("../collision-item.js"),e=a("../geom/circle.js"),f=a("../geom/point.js"),g=a("../io/mouse.js"),h=a("../dragon-collisions.js");b.exports=d({name:"screenhold",mask:e(f(),8),collisions:h}).extend({update:function(){g.is.down&&!g.is.dragging?this.move(g.offset):this.move(f(-999,-999)),this.base.update()}})},{"../collision-item.js":16,"../dragon-collisions.js":18,"../geom/circle.js":21,"../geom/point.js":23,"../io/mouse.js":34}],38:[function(a,b,c){var d=a("../collision-item.js"),e=a("../geom/circle.js"),f=a("../geom/point.js"),g=a("../io/mouse.js"),h=a("../dragon-collisions.js"),i=!1;g.on.down(function(){i=!0}),b.exports=d({name:"screentap",mask:e(f(),8),collisions:h}).extend({update:function(){i?(i=!1,this.move(g.offset)):this.move(f(-999,-999)),this.base.update()}})},{"../collision-item.js":16,"../dragon-collisions.js":18,"../geom/circle.js":21,"../geom/point.js":23,"../io/mouse.js":34}],39:[function(a,b,c){(function(c){var d=a("../clear-sprite.js"),e=a("../geom/vector.js"),f=a("../geom/dimension.js"),g=(a("../geom/point.js"),a("../util/random.js")),h=a("../util/object.js"),i=a("../util/timer.js");b.exports=function(a){var b,j,k=!1,l=a.pos;return a=h.mergeDefaults(a,{name:"dragon-particle",kind:"dragon-particle",size:f(4,4),rotationSpeed:.4*g()-.2,speed:e(g()-.5,g()-.5),lifespan:1e3,style:function(){},fade:.05}),j=a.speed.clone(),a.lifespan+=250*g(),d(a).extend({bankid:a.bankid,_create:function(){this.stop()},reset:function(){this.stop(),i.clear(b),k=!1,this.alpha=1,this.rotation=0,this.rotationSpeed=a.rotationSpeed,this.move(l),this.speed=j.clone()},start:function(){this.base.start(),b=i.setTimeout(function(){k=!0},a.lifespan)},update:function(){this.alpha>0?k&&(this.alpha-=a.fade,this.alpha=c.Math.max(0,this.alpha)):a.owner.reclaim(this),this.base.update()},draw:function(b){this.base.draw(b),a.style(b)}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../clear-sprite.js":13,"../geom/dimension.js":22,"../geom/point.js":23,"../geom/vector.js":27,"../util/object.js":52,"../util/random.js":53,"../util/timer.js":55}],40:[function(a,b,c){var d=a("./base.js"),e=a("../util/object.js"),f=a("../util/number.js");b.exports=function(a){return a=e.mergeDefaults(a,{name:"dragon-particle-circle"}),a.rotationSpeed=0,d(a).extend({draw:function(a){this.base.draw(a),a.beginPath(),a.arc(0,0,this.size().width/2,0,f.PI2),a.fill()}})}},{"../util/number.js":51,"../util/object.js":52,"./base.js":39}],41:[function(a,b,c){var d=a("../collection.js"),e=a("../geom/point.js"),f=a("../util/object.js"),g=(a("../io/canvas.js"),a("../util/timer.js"));b.exports=function(a){function b(){var a,b,c=h.splice(0,this.volume),d=c.length;for(a=0;d>a;a+=1)b=c[a],this.set[b].start()}var c,h=[];return a=f.mergeDefaults(a,{name:"dragon-emitter",kind:"dragon-emitter",pos:e(),speed:250,volume:4,style:function(){},conf:function(){}}),d(a).extend({sorted:!1,speed:a.speed,volume:a.volume,_create:function(){var d,e,f;for(d=0;50>d;d+=1)f=a.conf()||{},f.owner=this,f.pos=f.pos||a.pos,f.bankid=d,h.push(d),e=a.type(f),this.set.push(e);this.speed&&(c=g.setInterval(b,this.speed,this)),b.call(this)},draw:function(b){a.style(b),this.base.draw(b)},kill:function(){g.clear(c)},reclaim:function(a){a.reset(),h.push(a.bankid)}})}},{"../collection.js":14,"../geom/point.js":23,"../io/canvas.js":32,"../util/object.js":52,"../util/timer.js":55}],42:[function(a,b,c){var d=a("./base.js"),e=a("../util/object.js"),f=a("../assets/pipeline.js");b.exports=function(a){var b=f.get.image(a.src);return a=e.mergeDefaults(a,{name:"dragon-particle-image"}),d(a).extend({draw:function(a){this.base.draw(a),a.drawImage(b,-this.size().width/2,-this.size().height/2,this.size().width,this.size().height)}})}},{"../assets/pipeline.js":12,"../util/object.js":52,"./base.js":39}],43:[function(a,b,c){var d=a("./base.js"),e=a("../util/object.js");b.exports=function(a){return a=e.mergeDefaults(a,{name:"dragon-particle-square"}),d(a).extend({draw:function(a){this.base.draw(a),a.fillRect(-this.size().width/2,-this.size().height/2,this.size().width,this.size().height)}})}},{"../util/object.js":52,"./base.js":39}],44:[function(a,b,c){var d=a("./collection.js"),e=a("./util/object.js"),f=a("./game.js");b.exports=function(a){var b=d().add(a.collisions);return a=e.mergeDefaults(a,{name:"dragon-screen",kind:"dragon-screen",updating:!1,drawing:!1}),d(a).extend({_create:function(){this.add(a.sprites)},start:function(){b.start(),this.base.start()},pause:function(){b.pause(),this.base.pause()},stop:function(){b.stop(),this.base.stop()},addCollisions:b.add,sprite:function(a){return this.base.get(a)},addSprites:function(a){this.base.add(a)},removeSprite:function(a){this.base.remove(a)},clearSprites:function(){this.base.clear()},update:function(){this.base.update(),b.set.forEach(function(a){a.handleCollisions()})},draw:function(a){this.base.draw(a),f.debug&&b.draw(a)},teardown:function(){this.base.teardown(),b.teardown()}})}},{"./collection.js":14,"./game.js":20,"./util/object.js":52}],45:[function(a,b,c){(function(c){var d=a("./clear-sprite.js"),e=(a("./geom/dimension.js"),a("./animation-strip.js")),f=a("./util/object.js");b.exports=function(a){var b,g,h=a.strips||{};"string"==typeof h&&(h={strip:h});for(b in h)g=h[b],"string"==typeof g&&(h[b]=e(g));return a=f.mergeDefaults(a,{name:"dragon-sprite",kind:"dragon-sprite",startingStrip:a.startingStrip||c.Object.keys(h)[0]}),a.size=a.size||(h[a.startingStrip]||{}).size,d(a).extend({strip:h[a.startingStrip],useStrip:function(a){this.strip!==h[a]&&(this.strip.stop(),this.strip=h[a],this.strip.start())},getStrip:function(a){return h[a]},start:function(){this.base.start(),this.strip.start()},pause:function(){this.base.pause(),this.strip.pause()},stop:function(){this.base.stop(),this.strip.stop()},update:function(){this.strip.updating&&this.strip.update(),this.base.update()},draw:function(a){this.base.draw(a),this.strip.draw(a,this.size())}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./animation-strip.js":8,"./clear-sprite.js":13,"./geom/dimension.js":22,"./util/object.js":52}],46:[function(a,b,c){var d=a("../sprite.js"),e=a("../geom/rectangle.js"),f=(a("../geom/point.js"),a("../util/object.js"));b.exports=function(b){return b=f.mergeDefaults(b,{down:b.up,name:"dragon-ui-button",kind:"dragon-ui-button",on:{},strips:{},mask:e(),collisions:[],startingStrip:"up",onpress:function(){}}),b.collisions=[].concat(b.collisions,a("../dragon-collisions.js")),b.on["collide#screentap"]=function(){this.useStrip("down"),b.onpress.call(this)},b.on["miss#screenhold"]=function(){this.useStrip("up")},d(b)}},{"../dragon-collisions.js":18,"../geom/point.js":23,"../geom/rectangle.js":25,"../sprite.js":45,"../util/object.js":52}],47:[function(a,b,c){var d=a("../clear-sprite.js"),e=a("../util/object.js");b.exports=function(a){return a=e.mergeDefaults(a,{name:"dragon-ui-label",kind:"dragon-ui-label",text:"",style:function(){}}),d(a).extend({text:a.text,draw:function(b){a.style(b),b.fillText(this.text,this.pos.x,this.pos.y)}})}},{"../clear-sprite.js":13,"../util/object.js":52}],48:[function(a,b,c){b.exports="ontouchstart"in window},{}],49:[function(a,b,c){(function(c){var d,e=a("./timer.js"),f=frameCount=0;d=e.setInterval(function(a){var b=1e3+a;f=c.Math.floor(1e3*frameCount/b),frameCount=0},1e3),b.exports={countFrame:function(){frameCount+=1},get frameRate(){return f},kill:function(){e.clear(d)},draw:function(a){a.resetTransform(),a.globalAlpha=.5,a.font="30px Verdana",a.fillStyle="#f55",a.textBaseline="top",a.textAlign="left",a.fillText(f,20,20)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./timer.js":55}],50:[function(a,b,c){var d=0;b.exports={get lastId(){return d},get nextId(){return d+=1}}},{}],51:[function(a,b,c){(function(a){var c,d,e={},f={};for(c=6.28;c>=-6.28;c-=.01)d=c.toFixed(2),e[d]=a.Math.sin(c),f[d]=a.Math.cos(c);e["-0.00"]=e["0.00"],f["-0.00"]=f["0.00"],b.exports={PI:3.14159,PI2:6.28318,sin:function(a){var b;return a%=this.PI2,b=a.toFixed(2),e[b]},cos:function(a){var b;return a%=this.PI2,b=a.toFixed(2),f[b]},abs:function(a){return 0>a?-a:a}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],52:[function(a,b,c){(function(a){b.exports={cloneArray:function(a){var b=[];return a.forEach(function(a){b.push(this.clone(a))},this),b},cloneObject:function(a){var b,c={};if("clone"in a&&"function"==typeof a.clone)return a.clone();for(b in a)c[b]=this.clone(a[b]);return c},clone:function(b){return b instanceof a.Array?this.cloneArray(b):"object"==typeof b?this.cloneObject(b):b},mergeLeft:function(a,b,c){var d,e;a=a||{},b=b||{},e=c?a:this.clone(a);for(d in b)a[d]=b[d];return a},mergeDefaults:function(a,b,c){var d,e;a=a||{},b=b||{},e=c?a:this.clone(a);for(d in b)d in e&&"undefined"!=typeof e[d]||(e[d]=b[d]);return e}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],53:[function(a,b,c){(function(a){var c,d=200,e=[],f=0;for(c=0;d>c;c+=1)e.push(a.Math.random());b.exports=function(){return f+=1,f%=d,e[f]}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],54:[function(a,b,c){var d=a("./random.js");b.exports={shuffle:function(a){var b,c,e;for(b=0;b<a.length;b+=1)c=parseInt(d()*(b+1)),e=a[b],a[b]=a[c],a[c]=e;return a},range:function(a,b){var c,d,e=[];for(b||(b=a,a=0),d=b-a,c=0;d>c;c+=1)e.push(c+a);return e}}},{"./random.js":53}],55:[function(a,b,c){(function(c){var d=a("../item.js"),e=a("./id-counter.js"),f=c.Date.now(),g={},h=[],i=[],j=[],k=[];b.exports=d().extend({update:function(){var a=c.Date.now(),b=a-f,d=[],e=[];h.forEach(function(a){a.id in g||(a.life-=b,a.life<=0?a.event(-a.life):d.push(a))}),h=d.concat(i),i=[],j.forEach(function(a){a.id in g||(a.life-=b,a.life<=0&&(a.event(-a.life),a.life=a.delay),e.push(a))}),j=e.concat(k),k=[],f=a},setTimeout:function(a,b,c){var d=e.nextId;return i.push({event:a.bind(c),life:b,id:d}),d},setInterval:function(a,b,c){var d=e.nextId;return k.push({event:a.bind(c),life:b,delay:b,id:d}),d},clear:function(a){g[a]=!0}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../item.js":35,"./id-counter.js":50}],56:[function(a,b,c){var d=a("dragonjs");d.loadAssets(function(){d.debug(),d.addScreens([a("./screens/stage.js")])})},{"./screens/stage.js":57,dragonjs:17}],57:[function(a,b,c){var d=a("dragonjs");b.exports=d.Screen({name:"stage",sprites:[a("../sprites/fountain.js"),a("../sprites/burst.js"),a("../sprites/dust.js")],one:{$added:function(){this.start()}}}).extend({draw:function(a){d.canvas.clear(),this.base.draw(a)}})},{"../sprites/burst.js":58,"../sprites/dust.js":60,"../sprites/fountain.js":61,dragonjs:17}],58:[function(a,b,c){var d=a("dragonjs");b.exports=d.particle.Emitter({name:"burst",type:d.particle.Square,pos:d.canvas.center.add(d.Point(-120,50)),volume:5,speed:2e3,style:function(a){a.fillStyle="#b84760"},conf:function(){return{friction:.06,lifespan:1500,speed:d.Vector(6*(d.random()-.5),6*(d.random()-.5))}}})},{dragonjs:17}],59:[function(a,b,c){var d=a("dragonjs");b.exports=function(a){return d.particle.Image(a).extend({update:function(){this.base.update(),this.scale(this.scale()+.015)},reset:function(){this.base.reset(),this.scale(1)}})}},{dragonjs:17}],60:[function(a,b,c){var d=a("dragonjs");b.exports=d.particle.Emitter({name:"dust",type:a("./dust-particle.js"),pos:d.canvas.center.add(d.Point(0,-50)),volume:2,
speed:800,conf:function(){return{rotationSpeed:0,friction:.025,src:"dust.png",size:d.Dimension(12,4),lifespan:800,fade:.01,speed:d.Vector(.8*(d.random()-.5),-.1)}}})},{"./dust-particle.js":59,dragonjs:17}],61:[function(a,b,c){var d=a("dragonjs");b.exports=d.particle.Emitter({name:"fountain",type:d.particle.Circle,pos:d.canvas.center.add(d.Point(120,50)),style:function(a){a.fillStyle="#3114eb"},conf:function(){return{gravity:.015,friction:.01}}})},{dragonjs:17}]},{},[56]);